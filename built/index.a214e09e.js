var t=Object.defineProperty,e=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(e,i,s)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s,a=(t,e,i)=>(r(t,"symbol"!=typeof e?e+"":e,i),i);import{d as n,r as o,o as l,m as u,c as h,a as g,b as d}from"./vendor.3067a125.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerpolicy&&(e.referrerPolicy=t.referrerpolicy),"use-credentials"===t.crossorigin?e.credentials="include":"anonymous"===t.crossorigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();class c{constructor(){a(this,"angleX",0),a(this,"angleY",0),a(this,"angleZ",0),a(this,"angleEyeX",0),a(this,"angleEyeY",0),a(this,"mouseDistance",0),a(this,"autoBlink",!1)}}const _=class{constructor(t=0){t<1?(this._ptr=[],this._capacity=0,this._size=0):(this._ptr=new Array(t),this._capacity=t,this._size=0)}at(t){return this._ptr[t]}set(t,e){this._ptr[t]=e}get(t=0){const e=new Array;for(let i=t;i<this._size;i++)e.push(this._ptr[i]);return e}pushBack(t){this._size>=this._capacity&&this.prepareCapacity(0==this._capacity?_.s_defaultSize:2*this._capacity),this._ptr[this._size++]=t}clear(){this._ptr.length=0,this._size=0}getSize(){return this._size}assign(t,e){this._size<t&&this.prepareCapacity(t);for(let i=0;i<t;i++)this._ptr[i]=e;this._size=t}resize(t,e=null){this.updateSize(t,e,!0)}updateSize(t,e=null,i=!0){if(this._size<t)if(this.prepareCapacity(t),i)for(let s=this._size;s<t;s++)this._ptr[s]="function"==typeof e?JSON.parse(JSON.stringify(new e)):e;else for(let s=this._size;s<t;s++)this._ptr[s]=e;else{const e=this._size-t;this._ptr.splice(this._size-e,e)}this._size=t}insert(t,e,i){let s=t._index;const r=e._index,a=i._index,n=a-r;this.prepareCapacity(this._size+n);const o=this._size-s;if(o>0)for(let l=0;l<o;l++)this._ptr.splice(s+l,0,null);for(let l=r;l<a;l++,s++)this._ptr[s]=e._vector._ptr[l];this._size=this._size+n}remove(t){return!(t<0||this._size<=t)&&(this._ptr.splice(t,1),--this._size,!0)}erase(t){const e=t._index;if(e<0||this._size<=e)return t;this._ptr.splice(e,1),--this._size;return new p(this,e)}prepareCapacity(t){t>this._capacity&&(0==this._capacity?(this._ptr=new Array(t),this._capacity=t):(this._ptr.length=t,this._capacity=t))}begin(){return 0==this._size?this.end():new p(this,0)}end(){return new p(this,this._size)}getOffset(t){const e=new _;return e._ptr=this.get(t),e._size=this.get(t).length,e._capacity=this.get(t).length,e}};let m=_;m.s_defaultSize=10;class p{constructor(t,e){this._vector=null!=t?t:null,this._index=null!=e?e:0}set(t){return this._index=t._index,this._vector=t._vector,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new p(this._vector,this._index++)}decrement(){return new p(this._vector,this._index--)}ptr(){return this._vector._ptr[this._index]}substitution(t){return this._index=t._index,this._vector=t._vector,this}notEqual(t){return this._index!=t._index||this._vector!=t._vector}}var y,S,f,x,C,B,M,V,I;(S=y||(y={})).csmVector=m,S.iterator=p;class b{append(t,e){return this.s+=void 0!==e?t.substr(0,e):t,this}expansion(t,e){for(let i=0;i<t;i++)this.append(e);return this}getBytes(){return encodeURIComponent(this.s).replace(/%../g,"x").length}getLength(){return this.s.length}isLess(t){return this.s<t.s}isGreat(t){return this.s>t.s}isEqual(t){return this.s==t}isEmpty(){return 0==this.s.length}constructor(t){this.s=t}}(f||(f={})).csmString=b;class v{getString(){return this._id}constructor(t){this._id="string"!=typeof t?t:new b(t)}isEqual(t){return"string"==typeof t?this._id.isEqual(t):t instanceof b?this._id.isEqual(t.s):t instanceof v&&this._id.isEqual(t._id.s)}isNotEqual(t){return"string"==typeof t?!this._id.isEqual(t):t instanceof b?!this._id.isEqual(t.s):t instanceof v&&!this._id.isEqual(t._id.s)}}(x||(x={})).CubismId=v;class P{constructor(){this._ids=new m}release(){for(let t=0;t<this._ids.getSize();++t)this._ids.set(t,void 0);this._ids=null}registerIds(t){for(let e=0;e<t.length;e++)this.registerId(t[e])}registerId(t){let e=null;return"string"!=typeof t?this.registerId(t.s):(null!=(e=this.findId(t))||(e=new v(t),this._ids.pushBack(e)),e)}getId(t){return this.registerId(t)}isExist(t){return"string"==typeof t?null!=this.findId(t):this.isExist(t.s)}findId(t){for(let e=0;e<this._ids.getSize();++e)if(this._ids.at(e).getString().isEqual(t))return this._ids.at(e);return null}}(C||(C={})).CubismIdManager=P;class w{constructor(){this._tr=new Float32Array(16),this.loadIdentity()}static multiply(t,e,i){const s=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);for(let r=0;r<4;++r)for(let i=0;i<4;++i)for(let a=0;a<4;++a)s[i+4*r]+=t[a+4*r]*e[i+4*a];for(let r=0;r<16;++r)i[r]=s[r]}loadIdentity(){const t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(t)}setMatrix(t){for(let e=0;e<16;++e)this._tr[e]=t[e]}getArray(){return this._tr}getScaleX(){return this._tr[0]}getScaleY(){return this._tr[5]}getTranslateX(){return this._tr[12]}getTranslateY(){return this._tr[13]}transformX(t){return this._tr[0]*t+this._tr[12]}transformY(t){return this._tr[5]*t+this._tr[13]}invertTransformX(t){return(t-this._tr[12])/this._tr[0]}invertTransformY(t){return(t-this._tr[13])/this._tr[5]}translateRelative(t,e){const i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);w.multiply(i,this._tr,this._tr)}translate(t,e){this._tr[12]=t,this._tr[13]=e}translateX(t){this._tr[12]=t}translateY(t){this._tr[13]=t}scaleRelative(t,e){const i=new Float32Array([t,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1]);w.multiply(i,this._tr,this._tr)}scale(t,e){this._tr[0]=t,this._tr[5]=e}multiplyByMatrix(t){w.multiply(t.getArray(),this._tr,this._tr)}clone(){const t=new w;for(let e=0;e<this._tr.length;e++)t._tr[e]=this._tr[e];return t}}(B||(B={})).CubismMatrix44=w;class E{static create(){return null}static delete(t){}initialize(t){this._model=t}drawModel(){null!=this.getModel()&&this.doDrawModel()}setMvpMatrix(t){this._mvpMatrix4x4.setMatrix(t.getArray())}getMvpMatrix(){return this._mvpMatrix4x4}setModelColor(t,e,i,s){t<0?t=0:t>1&&(t=1),e<0?e=0:e>1&&(e=1),i<0?i=0:i>1&&(i=1),s<0?s=0:s>1&&(s=1),this._modelColor.R=t,this._modelColor.G=e,this._modelColor.B=i,this._modelColor.A=s}getModelColor(){return JSON.parse(JSON.stringify(this._modelColor))}setIsPremultipliedAlpha(t){this._isPremultipliedAlpha=t}isPremultipliedAlpha(){return this._isPremultipliedAlpha}setIsCulling(t){this._isCulling=t}isCulling(){return this._isCulling}setAnisotropy(t){this._anisortopy=t}getAnisotropy(){return this._anisortopy}getModel(){return this._model}constructor(){this._isCulling=!1,this._isPremultipliedAlpha=!1,this._anisortopy=0,this._model=null,this._modelColor=new T,this._mvpMatrix4x4=new w,this._mvpMatrix4x4.loadIdentity()}}(V=M||(M={}))[V.CubismBlendMode_Normal=0]="CubismBlendMode_Normal",V[V.CubismBlendMode_Additive=1]="CubismBlendMode_Additive",V[V.CubismBlendMode_Multiplicative=2]="CubismBlendMode_Multiplicative";class T{constructor(){this.R=1,this.G=1,this.B=1,this.A=1}}!function(t){t.CubismBlendMode=M,t.CubismRenderer=E,t.CubismTextureColor=T}(I||(I={}));const F=(t,e,i)=>{((t,e,i)=>{N.print(t,"[CSM]"+e,i)})(t,e+"\n",i)},R=t=>{console.assert(t)};let L,D,k,A;L=(t,...e)=>{F(ut.LogLevel_Debug,"[D]"+t,e)},D=(t,...e)=>{F(ut.LogLevel_Info,"[I]"+t,e)},k=(t,...e)=>{F(ut.LogLevel_Warning,"[W]"+t,e)},A=(t,...e)=>{F(ut.LogLevel_Error,"[E]"+t,e)};class N{static print(t,e,i){if(t<lt.getLoggingLevel())return;const s=lt.coreLogFunction;if(!s)return;s(e.replace(/\{(\d+)\}/g,((t,e)=>i[e])))}static dumpBytes(t,e,i){for(let s=0;s<i;s++)s%16==0&&s>0?this.print(t,"\n"):s%8==0&&s>0&&this.print(t,"  "),this.print(t,"{0} ",[255&e[s]]);this.print(t,"\n")}constructor(){}}var O;(O||(O={})).CubismDebug=N;class z{constructor(t,e){this.first=null==t?null:t,this.second=null==e?null:e}}const U=class{constructor(t){null!=t?t<1?(this._keyValues=[],this._dummyValue=null,this._size=0):(this._keyValues=new Array(t),this._size=t):(this._keyValues=[],this._dummyValue=null,this._size=0)}release(){this.clear()}appendKey(t){this.prepareCapacity(this._size+1,!1),this._keyValues[this._size]=new z(t),this._size+=1}getValue(t){let e=-1;for(let i=0;i<this._size;i++)if(this._keyValues[i].first==t){e=i;break}return e>=0?this._keyValues[e].second:(this.appendKey(t),this._keyValues[this._size-1].second)}setValue(t,e){let i=-1;for(let s=0;s<this._size;s++)if(this._keyValues[s].first==t){i=s;break}i>=0?this._keyValues[i].second=e:(this.appendKey(t),this._keyValues[this._size-1].second=e)}isExist(t){for(let e=0;e<this._size;e++)if(this._keyValues[e].first==t)return!0;return!1}clear(){this._keyValues=void 0,this._keyValues=null,this._keyValues=[],this._size=0}getSize(){return this._size}prepareCapacity(t,e){t>this._keyValues.length&&(0==this._keyValues.length?(!e&&t<U.DefaultSize&&(t=U.DefaultSize),this._keyValues.length=t):(!e&&t<2*this._keyValues.length&&(t=2*this._keyValues.length),this._keyValues.length=t))}begin(){return new X(this,0)}end(){return new X(this,this._size)}erase(t){const e=t._index;if(e<0||this._size<=e)return t;this._keyValues.splice(e,1),--this._size;return new X(this,e)}dumpAsInt(){for(let t=0;t<this._size;t++)L("{0} ,",this._keyValues[t]),L("\n")}};let j=U;j.DefaultSize=10;class X{constructor(t,e){this._map=null!=t?t:new j,this._index=null!=e?e:0}set(t){return this._index=t._index,this._map=t._map,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new X(this._map,this._index++)}decrement(){const t=new X(this._map,this._index);return this._map=t._map,this._index=t._index,this}ptr(){return this._map._keyValues[this._index]}notEqual(t){return this._index!=t._index||this._map!=t._map}}var G;!function(t){t.csmMap=j,t.csmPair=z,t.iterator=X}(G||(G={}));class Y{constructor(){}getRawString(t,e){return this.getString(t,e)}toInt(t=0){return t}toFloat(t=0){return t}toBoolean(t=!1){return t}getSize(){return 0}getArray(t=null){return t}getVector(t=new m){return t}getMap(t){return t}getValueByIndex(t){return Y.errorValue.setErrorNotForClientCall("Error: type mismatch")}getValueByString(t){return Y.nullValue.setErrorNotForClientCall("Error: type mismatch")}getKeys(){return Y.s_dummyKeys}isError(){return!1}isNull(){return!1}isBool(){return!1}isFloat(){return!1}isString(){return!1}isArray(){return!1}isMap(){return!1}equals(t){return!1}isStatic(){return!1}setErrorNotForClientCall(t){return K.errorValue}static staticInitializeNotForClientCall(){H.trueValue=new H(!0),H.falseValue=new H(!1),Y.errorValue=new K("ERROR",!0),Y.nullValue=new Z,Y.s_dummyKeys=new m}static staticReleaseNotForClientCall(){H.trueValue=null,H.falseValue=null,Y.errorValue=null,Y.nullValue=null,Y.s_dummyKeys=null}}class q{constructor(t,e){this._error=null,this._lineCount=0,this._root=null,null!=t&&this.parseBytes(t,e)}static create(t,e){const i=new q;return i.parseBytes(t,e)?i:(q.delete(i),null)}static delete(t){}getRoot(){return this._root}arrayBufferToString(t){const e=new Uint8Array(t);let i="";for(let s=0,r=e.length;s<r;++s)i+="%"+this.pad(e[s].toString(16));return i=decodeURIComponent(i),i}pad(t){return t.length<2?"0"+t:t}parseBytes(t,e){const i=new Array(1),s=this.arrayBufferToString(t);if(this._root=this.parseValue(s,e,0,i),this._error){let t="\0";return t="Json parse error : @line "+(this._lineCount+1)+"\n",this._root=new J(t),D("{0}",this._root.getRawString()),!1}return null!=this._root||(this._root=new K(new b(this._error),!1),!1)}getParseError(){return this._error}checkEndOfFile(){return this._root.getArray()[1].equals("EOF")}parseValue(t,e,i,s){if(this._error)return null;let r,a=null,n=i;for(;n<e;n++){switch(t[n]){case"-":case".":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{const e=new Array(1);return r=et(t.slice(n),e),s[0]=t.indexOf(e[0]),new W(r)}case'"':return new J(this.parseString(t,e,n+1,s));case"[":return a=this.parseArray(t,e,n+1,s),a;case"{":return a=this.parseObject(t,e,n+1,s),a;case"n":return n+3<e?(a=new Z,s[0]=n+4):this._error="parse null",a;case"t":return n+3<e?(a=H.trueValue,s[0]=n+4):this._error="parse true",a;case"f":return n+4<e?(a=H.falseValue,s[0]=n+5):this._error="illegal ',' position",a;case",":return this._error="illegal ',' position",null;case"]":return s[0]=n,null;case"\n":this._lineCount++}}return this._error="illegal end of value",null}parseString(t,e,i,s){if(this._error)return null;let r,a,n=i;const o=new b("");let l=i;for(;n<e;n++)switch(r=t[n],r){case'"':return s[0]=n+1,o.append(t.slice(l),n-l),o.s;case"//":if(n++,n-1>l&&o.append(t.slice(l),n-l),l=n+1,n<e)switch(a=t[n],a){case"\\":o.expansion(1,"\\");break;case'"':o.expansion(1,'"');break;case"/":o.expansion(1,"/");break;case"b":o.expansion(1,"\b");break;case"f":o.expansion(1,"\f");break;case"n":o.expansion(1,"\n");break;case"r":o.expansion(1,"\r");break;case"t":o.expansion(1,"\t");break;case"u":this._error="parse string/unicord escape not supported"}else this._error="parse string/escape error"}return this._error="parse string/illegal end",null}parseObject(t,e,i,s){if(this._error)return null;const r=new $;let a="",n=i,o="";const l=Array(1);let u=!1;for(;n<e;n++){t:for(;n<e;n++)switch(o=t[n],o){case'"':if(a=this.parseString(t,e,n+1,l),this._error)return null;n=l[0],u=!0;break t;case"}":return s[0]=n+1,r;case":":this._error="illegal ':' position";break;case"\n":this._lineCount++}if(!u)return this._error="key not found",null;u=!1;t:for(;n<e;n++)switch(o=t[n],o){case":":u=!0,n++;break t;case"}":this._error="illegal '}' position";break;case"\n":this._lineCount++}if(!u)return this._error="':' not found",null;const i=this.parseValue(t,e,n,l);if(this._error)return null;n=l[0],r.put(a,i);t:for(;n<e;n++)switch(o=t[n],o){case",":break t;case"}":return s[0]=n+1,r;case"\n":this._lineCount++}}return this._error="illegal end of perseObject",null}parseArray(t,e,i,s){if(this._error)return null;let r,a=new Q,n=i;const o=new Array(1);for(;n<e;n++){const i=this.parseValue(t,e,n,o);if(this._error)return null;n=o[0],i&&a.add(i);t:for(;n<e;n++)switch(r=t[n],r){case",":break t;case"]":return s[0]=n+1,a;case"\n":++this._lineCount}}return a=void 0,this._error="illegal end of parseObject",null}}class W extends Y{constructor(t){super(),this._value=t}isFloat(){return!0}getString(t,e){return this._value=parseFloat("\0"),this._stringBuffer="\0",this._stringBuffer}toInt(t=0){return parseInt(this._value.toString())}toFloat(t=0){return this._value}equals(t){return"number"==typeof t&&(!Math.round(t)&&t==this._value)}}class H extends Y{isBool(){return!0}toBoolean(t=!1){return this._boolValue}getString(t,e){return this._stringBuffer=this._boolValue?"true":"false",this._stringBuffer}equals(t){return"boolean"==typeof t&&t==this._boolValue}isStatic(){return!0}constructor(t){super(),this._boolValue=t}}class J extends Y{constructor(t){super(),"string"==typeof t&&(this._stringBuffer=t),t instanceof b&&(this._stringBuffer=t.s)}isString(){return!0}getString(t,e){return this._stringBuffer}equals(t){return"string"==typeof t?this._stringBuffer==t:t instanceof b&&this._stringBuffer==t.s}}class K extends J{isStatic(){return this._isStatic}setErrorNotForClientCall(t){return this._stringBuffer=t,this}constructor(t,e){super(t),this._isStatic=e}isError(){return!0}}class Z extends Y{isNull(){return!0}getString(t,e){return this._stringBuffer}isStatic(){return!0}setErrorNotForClientCall(t){return this._stringBuffer=t,K.nullValue}constructor(){super(),this._stringBuffer="NullValue"}}class Q extends Y{constructor(){super(),this._array=new m}release(){for(let t=this._array.begin();t.notEqual(this._array.end());t.preIncrement()){let e=t.ptr();e&&!e.isStatic()&&(e=void 0,e=null)}}isArray(){return!0}getValueByIndex(t){if(t<0||this._array.getSize()<=t)return Y.errorValue.setErrorNotForClientCall("Error: index out of bounds");const e=this._array.at(t);return null==e?Y.nullValue:e}getValueByString(t){return Y.errorValue.setErrorNotForClientCall("Error: type mismatch")}getString(t,e){const i=e+"[\n";for(let s=this._array.begin();s.notEqual(this._array.end());s.increment()){const t=s.ptr();this._stringBuffer+=e+""+t.getString(e+" ")+"\n"}return this._stringBuffer=i+e+"]\n",this._stringBuffer}add(t){this._array.pushBack(t)}getVector(t=null){return this._array}getSize(){return this._array.getSize()}}class $ extends Y{constructor(){super(),this._map=new j}release(){const t=this._map.begin();for(;t.notEqual(this._map.end());){let e=t.ptr().second;e&&!e.isStatic()&&(e=void 0,e=null),t.preIncrement()}}isMap(){return!0}getValueByString(t){if(t instanceof b){const e=this._map.getValue(t.s);return null==e?Y.nullValue:e}for(let e=this._map.begin();e.notEqual(this._map.end());e.preIncrement())if(e.ptr().first==t)return null==e.ptr().second?Y.nullValue:e.ptr().second;return Y.nullValue}getValueByIndex(t){return Y.errorValue.setErrorNotForClientCall("Error: type mismatch")}getString(t,e){this._stringBuffer=e+"{\n";const i=this._map.begin();for(;i.notEqual(this._map.end());){const t=i.ptr().first,s=i.ptr().second;this._stringBuffer+=e+" "+t+" : "+s.getString(e+"   ")+" \n",i.preIncrement()}return this._stringBuffer+=e+"}\n",this._stringBuffer}getMap(t){return this._map}put(t,e){this._map.setValue(t,e)}getKeys(){if(!this._keys){this._keys=new m;const t=this._map.begin();for(;t.notEqual(this._map.end());){const e=t.ptr().first;this._keys.pushBack(e),t.preIncrement()}}return this._keys}getSize(){return this._keys.getSize()}}var tt;function et(t,e){let i=0;for(let r=1;;r++){const e=t.slice(r-1,r);if("e"==e||"-"==e||"E"==e)continue;const s=t.substring(0,r),a=Number(s);if(isNaN(a))break;i=r}let s=parseFloat(t);return isNaN(s)&&(s=NaN),e[0]=t.slice(i),s}!function(t){t.CubismJson=q,t.JsonArray=Q,t.JsonBoolean=H,t.JsonError=K,t.JsonFloat=W,t.JsonMap=$,t.JsonNullvalue=Z,t.JsonString=J,t.Value=Y}(tt||(tt={}));let it=!1,st=!1,rt=null,at=null;const nt=Object.freeze({vertexOffset:0,vertexStep:2});function ot(t){t&&(t=void 0)}class lt{static startUp(t=null){if(it)return D("CubismFramework.startUp() is already done."),it;if(rt=t,null!=rt&&Live2DCubismCore.Logging.csmSetLogFunction(rt.logFunction),it=!0,it){const t=Live2DCubismCore.Version.csmGetVersion(),e=(16711680&t)>>16,i=65535&t,s=t;D("Live2D Cubism Core version: {0}.{1}.{2} ({3})",("00"+((4278190080&t)>>24)).slice(-2),("00"+e).slice(-2),("0000"+i).slice(-4),s)}return D("CubismFramework.startUp() is complete."),it}static cleanUp(){it=!1,st=!1,rt=null,at=null}static initialize(){R(it),it?st?k("CubismFramework.initialize() skipped, already initialized."):(Y.staticInitializeNotForClientCall(),at=new P,st=!0,D("CubismFramework.initialize() is complete.")):k("CubismFramework is not started.")}static dispose(){R(it),it?st?(Y.staticReleaseNotForClientCall(),at.release(),at=null,E.staticRelease(),st=!1,D("CubismFramework.dispose() is complete.")):k("CubismFramework.dispose() skipped, not initialized."):k("CubismFramework is not started.")}static isStarted(){return it}static isInitialized(){return st}static coreLogFunction(t){Live2DCubismCore.Logging.csmGetLogFunction()&&Live2DCubismCore.Logging.csmGetLogFunction()(t)}static getLoggingLevel(){return null!=rt?rt.loggingLevel:ut.LogLevel_Off}static getIdManager(){return at}constructor(){}}var ut,ht,gt,dt;(ht=ut||(ut={}))[ht.LogLevel_Verbose=0]="LogLevel_Verbose",ht[ht.LogLevel_Debug=1]="LogLevel_Debug",ht[ht.LogLevel_Info=2]="LogLevel_Info",ht[ht.LogLevel_Warning=3]="LogLevel_Warning",ht[ht.LogLevel_Error=4]="LogLevel_Error",ht[ht.LogLevel_Off=5]="LogLevel_Off",function(t){t.Constant=nt,t.csmDelete=ot,t.CubismFramework=lt}(gt||(gt={}));class ct{}(dt||(dt={})).ICubismModelSetting=ct;const _t="Name";var mt,pt,yt,St;(pt=mt||(mt={}))[pt.FrequestNode_Groups=0]="FrequestNode_Groups",pt[pt.FrequestNode_Moc=1]="FrequestNode_Moc",pt[pt.FrequestNode_Motions=2]="FrequestNode_Motions",pt[pt.FrequestNode_Expressions=3]="FrequestNode_Expressions",pt[pt.FrequestNode_Textures=4]="FrequestNode_Textures",pt[pt.FrequestNode_Physics=5]="FrequestNode_Physics",pt[pt.FrequestNode_Pose=6]="FrequestNode_Pose",pt[pt.FrequestNode_HitAreas=7]="FrequestNode_HitAreas";class ft extends ct{constructor(t,e){super(),this._json=q.create(t,e),this._json&&(this._jsonValue=new m,this._jsonValue.pushBack(this._json.getRoot().getValueByString("Groups")),this._jsonValue.pushBack(this._json.getRoot().getValueByString("FileReferences").getValueByString("Moc")),this._jsonValue.pushBack(this._json.getRoot().getValueByString("FileReferences").getValueByString("Motions")),this._jsonValue.pushBack(this._json.getRoot().getValueByString("FileReferences").getValueByString("Expressions")),this._jsonValue.pushBack(this._json.getRoot().getValueByString("FileReferences").getValueByString("Textures")),this._jsonValue.pushBack(this._json.getRoot().getValueByString("FileReferences").getValueByString("Physics")),this._jsonValue.pushBack(this._json.getRoot().getValueByString("FileReferences").getValueByString("Pose")),this._jsonValue.pushBack(this._json.getRoot().getValueByString("HitAreas")))}release(){q.delete(this._json),this._jsonValue=null}GetJson(){return this._json}getModelFileName(){return this.isExistModelFile()?this._jsonValue.at(1).getRawString():""}getTextureCount(){return this.isExistTextureFiles()?this._jsonValue.at(4).getSize():0}getTextureDirectory(){return this._jsonValue.at(4).getRawString()}getTextureFileName(t){return this._jsonValue.at(4).getValueByIndex(t).getRawString()}getHitAreasCount(){return this.isExistHitAreas()?this._jsonValue.at(7).getSize():0}getHitAreaId(t){return lt.getIdManager().getId(this._jsonValue.at(7).getValueByIndex(t).getValueByString("Id").getRawString())}getHitAreaName(t){return this._jsonValue.at(7).getValueByIndex(t).getValueByString(_t).getRawString()}getPhysicsFileName(){return this.isExistPhysicsFile()?this._jsonValue.at(5).getRawString():""}getPoseFileName(){return this.isExistPoseFile()?this._jsonValue.at(6).getRawString():""}getExpressionCount(){return this.isExistExpressionFile()?this._jsonValue.at(3).getSize():0}getExpressionName(t){return this._jsonValue.at(3).getValueByIndex(t).getValueByString(_t).getRawString()}getExpressionFileName(t){return this._jsonValue.at(3).getValueByIndex(t).getValueByString("File").getRawString()}getMotionGroupCount(){return this.isExistMotionGroups()?this._jsonValue.at(2).getKeys().getSize():0}getMotionGroupName(t){return this.isExistMotionGroups()?this._jsonValue.at(2).getKeys().at(t):null}getMotionCount(t){return this.isExistMotionGroupName(t)?this._jsonValue.at(2).getValueByString(t).getSize():0}getMotionFileName(t,e){return this.isExistMotionGroupName(t)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString("File").getRawString():""}getMotionSoundFileName(t,e){return this.isExistMotionSoundFile(t,e)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString("Sound").getRawString():""}getMotionFadeInTimeValue(t,e){return this.isExistMotionFadeIn(t,e)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString("FadeInTime").toFloat():-1}getMotionFadeOutTimeValue(t,e){return this.isExistMotionFadeOut(t,e)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString("FadeOutTime").toFloat():-1}getUserDataFile(){return this.isExistUserDataFile()?this._json.getRoot().getValueByString("FileReferences").getValueByString("UserData").getRawString():""}getLayoutMap(t){const e=this._json.getRoot().getValueByString("Layout").getMap();if(null==e)return!1;let i=!1;for(const s=e.begin();s.notEqual(e.end());s.preIncrement())t.setValue(s.ptr().first,s.ptr().second.toFloat()),i=!0;return i}getEyeBlinkParameterCount(){if(!this.isExistEyeBlinkParameters())return 0;let t=0;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const i=this._jsonValue.at(0).getValueByIndex(e);if(!i.isNull()&&!i.isError()&&"EyeBlink"==i.getValueByString(_t).getRawString()){t=i.getValueByString("Ids").getVector().getSize();break}}return t}getEyeBlinkParameterId(t){if(!this.isExistEyeBlinkParameters())return null;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const i=this._jsonValue.at(0).getValueByIndex(e);if(!i.isNull()&&!i.isError()&&"EyeBlink"==i.getValueByString(_t).getRawString())return lt.getIdManager().getId(i.getValueByString("Ids").getValueByIndex(t).getRawString())}return null}getLipSyncParameterCount(){if(!this.isExistLipSyncParameters())return 0;let t=0;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const i=this._jsonValue.at(0).getValueByIndex(e);if(!i.isNull()&&!i.isError()&&"LipSync"==i.getValueByString(_t).getRawString()){t=i.getValueByString("Ids").getVector().getSize();break}}return t}getLipSyncParameterId(t){if(!this.isExistLipSyncParameters())return null;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const i=this._jsonValue.at(0).getValueByIndex(e);if(!i.isNull()&&!i.isError()&&"LipSync"==i.getValueByString(_t).getRawString())return lt.getIdManager().getId(i.getValueByString("Ids").getValueByIndex(t).getRawString())}return null}isExistModelFile(){const t=this._jsonValue.at(1);return!t.isNull()&&!t.isError()}isExistTextureFiles(){const t=this._jsonValue.at(4);return!t.isNull()&&!t.isError()}isExistHitAreas(){const t=this._jsonValue.at(7);return!t.isNull()&&!t.isError()}isExistPhysicsFile(){const t=this._jsonValue.at(5);return!t.isNull()&&!t.isError()}isExistPoseFile(){const t=this._jsonValue.at(6);return!t.isNull()&&!t.isError()}isExistExpressionFile(){const t=this._jsonValue.at(3);return!t.isNull()&&!t.isError()}isExistMotionGroups(){const t=this._jsonValue.at(2);return!t.isNull()&&!t.isError()}isExistMotionGroupName(t){const e=this._jsonValue.at(2).getValueByString(t);return!e.isNull()&&!e.isError()}isExistMotionSoundFile(t,e){const i=this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString("Sound");return!i.isNull()&&!i.isError()}isExistMotionFadeIn(t,e){const i=this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString("FadeInTime");return!i.isNull()&&!i.isError()}isExistMotionFadeOut(t,e){const i=this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString("FadeOutTime");return!i.isNull()&&!i.isError()}isExistUserDataFile(){const t=this._json.getRoot().getValueByString("FileReferences").getValueByString("UserData");return!t.isNull()&&!t.isError()}isExistEyeBlinkParameters(){if(this._jsonValue.at(0).isNull()||this._jsonValue.at(0).isError())return!1;for(let t=0;t<this._jsonValue.at(0).getSize();++t)if("EyeBlink"==this._jsonValue.at(0).getValueByIndex(t).getValueByString(_t).getRawString())return!0;return!1}isExistLipSyncParameters(){if(this._jsonValue.at(0).isNull()||this._jsonValue.at(0).isError())return!1;for(let t=0;t<this._jsonValue.at(0).getSize();++t)if("LipSync"==this._jsonValue.at(0).getValueByIndex(t).getValueByString(_t).getRawString())return!0;return!1}}(yt||(yt={})).CubismModelSettingJson=ft;class xt{static create(){return new xt}static delete(t){}setParameters(t){this._breathParameters=t}getParameters(){return this._breathParameters}updateParameters(t,e){this._currentTime+=e;const i=2*this._currentTime*3.14159;for(let s=0;s<this._breathParameters.getSize();++s){const e=this._breathParameters.at(s);t.addParameterValueById(e.parameterId,e.offset+e.peak*Math.sin(i/e.cycle),e.weight)}}constructor(){this._currentTime=0}}class Ct{constructor(t,e,i,s,r){this.parameterId=null==t?null:t,this.offset=null==e?0:e,this.peak=null==i?0:i,this.cycle=null==s?0:s,this.weight=null==r?0:r}}!function(t){t.BreathParameterData=Ct,t.CubismBreath=xt}(St||(St={}));const Bt=class{static create(t=null){return new Bt(t)}static delete(t){}setBlinkingInterval(t){this._blinkingIntervalSeconds=t}setBlinkingSetting(t,e,i){this._closingSeconds=t,this._closedSeconds=e,this._openingSeconds=i}setParameterIds(t){this._parameterIds=t}getParameterIds(){return this._parameterIds}updateParameters(t,e){let i;this._userTimeSeconds+=e;let s=0;switch(this._blinkingState){case Vt.EyeState_Closing:s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closingSeconds,s>=1&&(s=1,this._blinkingState=Vt.EyeState_Closed,this._stateStartTimeSeconds=this._userTimeSeconds),i=1-s;break;case Vt.EyeState_Closed:s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closedSeconds,s>=1&&(this._blinkingState=Vt.EyeState_Opening,this._stateStartTimeSeconds=this._userTimeSeconds),i=0;break;case Vt.EyeState_Opening:s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._openingSeconds,s>=1&&(s=1,this._blinkingState=Vt.EyeState_Interval,this._nextBlinkingTime=this.determinNextBlinkingTiming()),i=s;break;case Vt.EyeState_Interval:this._nextBlinkingTime<this._userTimeSeconds&&(this._blinkingState=Vt.EyeState_Closing,this._stateStartTimeSeconds=this._userTimeSeconds),i=1;break;case Vt.EyeState_First:default:this._blinkingState=Vt.EyeState_Interval,this._nextBlinkingTime=this.determinNextBlinkingTiming(),i=1}Bt.CloseIfZero||(i=-i);for(let r=0;r<this._parameterIds.getSize();++r)t.setParameterValueById(this._parameterIds.at(r),i)}constructor(t){if(this._blinkingState=Vt.EyeState_First,this._nextBlinkingTime=0,this._stateStartTimeSeconds=0,this._blinkingIntervalSeconds=4,this._closingSeconds=.1,this._closedSeconds=.05,this._openingSeconds=.15,this._userTimeSeconds=0,this._parameterIds=new m,null!=t)for(let e=0;e<t.getEyeBlinkParameterCount();++e)this._parameterIds.pushBack(t.getEyeBlinkParameterId(e))}determinNextBlinkingTiming(){const t=Math.random();return this._userTimeSeconds+t*(2*this._blinkingIntervalSeconds-1)}};let Mt=Bt;var Vt,It,bt;Mt.CloseIfZero=!0,(It=Vt||(Vt={}))[It.EyeState_First=0]="EyeState_First",It[It.EyeState_Interval=1]="EyeState_Interval",It[It.EyeState_Closing=2]="EyeState_Closing",It[It.EyeState_Closed=3]="EyeState_Closed",It[It.EyeState_Opening=4]="EyeState_Opening",function(t){t.CubismEyeBlink=Mt,t.EyeState=Vt}(bt||(bt={}));class vt{static create(t,e){const i=new vt,s=q.create(t,e),r=s.getRoot();r.getValueByString("FadeInTime").isNull()||(i._fadeTimeSeconds=r.getValueByString("FadeInTime").toFloat(.5),i._fadeTimeSeconds<=0&&(i._fadeTimeSeconds=.5));const a=r.getValueByString("Groups"),n=a.getSize();for(let o=0;o<n;++o){const t=a.getValueByIndex(o),e=t.getSize();let s=0;for(let r=0;r<e;++r){const e=t.getValueByIndex(r),a=new Pt,n=lt.getIdManager().getId(e.getValueByString("Id").getRawString());if(a.partId=n,!e.getValueByString("Link").isNull()){const t=e.getValueByString("Link"),i=t.getSize();for(let e=0;e<i;++e){const i=new Pt,s=lt.getIdManager().getId(t.getValueByIndex(e).getString());i.partId=s,a.link.pushBack(i)}}i._partGroups.pushBack(a.clone()),++s}i._partGroupCounts.pushBack(s)}return q.delete(s),i}static delete(t){}updateParameters(t,e){t!=this._lastModel&&this.reset(t),this._lastModel=t,e<0&&(e=0);let i=0;for(let s=0;s<this._partGroupCounts.getSize();s++){const r=this._partGroupCounts.at(s);this.doFade(t,e,i,r),i+=r}this.copyPartOpacities(t)}reset(t){let e=0;for(let i=0;i<this._partGroupCounts.getSize();++i){const s=this._partGroupCounts.at(i);for(let i=e;i<e+s;++i){this._partGroups.at(i).initialize(t);const s=this._partGroups.at(i).partIndex,r=this._partGroups.at(i).parameterIndex;if(!(s<0)){t.setPartOpacityByIndex(s,i==e?1:0),t.setParameterValueByIndex(r,i==e?1:0);for(let e=0;e<this._partGroups.at(i).link.getSize();++e)this._partGroups.at(i).link.at(e).initialize(t)}}e+=s}}copyPartOpacities(t){for(let e=0;e<this._partGroups.getSize();++e){const i=this._partGroups.at(e);if(0==i.link.getSize())continue;const s=this._partGroups.at(e).partIndex,r=t.getPartOpacityByIndex(s);for(let e=0;e<i.link.getSize();++e){const s=i.link.at(e).partIndex;s<0||t.setPartOpacityByIndex(s,r)}}}doFade(t,e,i,s){let r=-1,a=1;const n=.5;for(let o=i;o<i+s;++o){const i=this._partGroups.at(o).partIndex,s=this._partGroups.at(o).parameterIndex;if(t.getParameterValueByIndex(s)>.001){if(r>=0)break;r=o,a=t.getPartOpacityByIndex(i),a+=e/this._fadeTimeSeconds,a>1&&(a=1)}}r<0&&(r=0,a=1);for(let o=i;o<i+s;++o){const e=this._partGroups.at(o).partIndex;if(r==o)t.setPartOpacityByIndex(e,a);else{let i,s=t.getPartOpacityByIndex(e);i=a<n?-.5*a/n+1:(1-a)*n/.5;(1-i)*(1-a)>.15&&(i=1-.15/(1-a)),s>i&&(s=i),t.setPartOpacityByIndex(e,s)}}}constructor(){this._fadeTimeSeconds=.5,this._lastModel=null,this._partGroups=new m,this._partGroupCounts=new m}}class Pt{constructor(t){if(this.parameterIndex=0,this.partIndex=0,this.link=new m,null!=t){this.partId=t.partId;for(const e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone())}}assignment(t){this.partId=t.partId;for(const e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone());return this}initialize(t){this.parameterIndex=t.getParameterIndex(this.partId),this.partIndex=t.getPartIndex(this.partId),t.setParameterValueByIndex(this.parameterIndex,1)}clone(){const t=new Pt;t.partId=this.partId,t.parameterIndex=this.parameterIndex,t.partIndex=this.partIndex,t.link=new m;for(let e=this.link.begin();e.notEqual(this.link.end());e.increment())t.link.pushBack(e.ptr().clone());return t}}var wt,Et,Tt;!function(t){t.CubismPose=vt,t.PartData=Pt}(wt||(wt={}));class Ft extends w{constructor(t,e){super(),this._width=void 0!==t?t:0,this._height=void 0!==e?e:0,this.setHeight(2)}setWidth(t){const e=t/this._width,i=e;this.scale(e,i)}setHeight(t){const e=t/this._height,i=e;this.scale(e,i)}setPosition(t,e){this.translate(t,e)}setCenterPosition(t,e){this.centerX(t),this.centerY(e)}top(t){this.setY(t)}bottom(t){const e=this._height*this.getScaleY();this.translateY(t-e)}left(t){this.setX(t)}right(t){const e=this._width*this.getScaleX();this.translateX(t-e)}centerX(t){const e=this._width*this.getScaleX();this.translateX(t-e/2)}setX(t){this.translateX(t)}centerY(t){const e=this._height*this.getScaleY();this.translateY(t-e/2)}setY(t){this.translateY(t)}setupFromLayout(t){for(const e=t.begin();e.notEqual(t.end());e.preIncrement()){const t=e.ptr().first,i=e.ptr().second;"width"==t?this.setWidth(i):"height"==t&&this.setHeight(i)}for(const e=t.begin();e.notEqual(t.end());e.preIncrement()){const t=e.ptr().first,i=e.ptr().second;"x"==t?this.setX(i):"y"==t?this.setY(i):"center_x"==t?this.centerX(i):"center_y"==t?this.centerY(i):"top"==t?this.top(i):"bottom"==t?this.bottom(i):"left"==t?this.left(i):"right"==t&&this.right(i)}}}(Et||(Et={})).CubismModelMatrix=Ft;class Rt{constructor(t,e){this.x=t,this.y=e,this.x=null==t?0:t,this.y=null==e?0:e}add(t){const e=new Rt(0,0);return e.x=this.x+t.x,e.y=this.y+t.y,e}substract(t){const e=new Rt(0,0);return e.x=this.x-t.x,e.y=this.y-t.y,e}multiply(t){const e=new Rt(0,0);return e.x=this.x*t.x,e.y=this.y*t.y,e}multiplyByScaler(t){return this.multiply(new Rt(t,t))}division(t){const e=new Rt(0,0);return e.x=this.x/t.x,e.y=this.y/t.y,e}divisionByScalar(t){return this.division(new Rt(t,t))}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}getDistanceWith(t){return Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y))}dot(t){return this.x*t.x+this.y*t.y}normalize(){const t=Math.pow(this.x*this.x+this.y*this.y,.5);this.x=this.x/t,this.y=this.y/t}isEqual(t){return this.x==t.x&&this.y==t.y}isNotEqual(t){return!this.isEqual(t)}}(Tt||(Tt={})).CubismVector2=Rt;const Lt=class{static range(t,e,i){return t<e?t=e:t>i&&(t=i),t}static sin(t){return Math.sin(t)}static cos(t){return Math.cos(t)}static abs(t){return Math.abs(t)}static sqrt(t){return Math.sqrt(t)}static cbrt(t){if(0===t)return t;let e=t;const i=e<0;let s;return i&&(e=-e),e===1/0?s=1/0:(s=Math.exp(Math.log(e)/3),s=(e/(s*s)+2*s)/3),i?-s:s}static getEasingSine(t){return t<0?0:t>1?1:.5-.5*this.cos(t*Math.PI)}static max(t,e){return t>e?t:e}static min(t,e){return t>e?e:t}static degreesToRadian(t){return t/180*Math.PI}static radianToDegrees(t){return 180*t/Math.PI}static directionToRadian(t,e){let i=Math.atan2(e.y,e.x)-Math.atan2(t.y,t.x);for(;i<-Math.PI;)i+=2*Math.PI;for(;i>Math.PI;)i-=2*Math.PI;return i}static directionToDegrees(t,e){const i=this.directionToRadian(t,e);let s=this.radianToDegrees(i);return e.x-t.x>0&&(s=-s),s}static radianToDirection(t){const e=new Rt;return e.x=this.sin(t),e.y=this.cos(t),e}static quadraticEquation(t,e,i){return this.abs(t)<Lt.Epsilon?this.abs(e)<Lt.Epsilon?-i:-i/e:-(e+this.sqrt(e*e-4*t*i))/(2*t)}static cardanoAlgorithmForBezier(t,e,i,s){if(this.sqrt(t)<Lt.Epsilon)return this.range(this.quadraticEquation(e,i,s),0,1);const r=e/t,a=i/t,n=(3*a-r*r)/3,o=n/3,l=(2*r*r*r-9*r*a+27*(s/t))/27,u=l/2,h=u*u+o*o*o,g=.5,d=.51;if(h<0){const t=-n/3,e=t*t*t,i=this.sqrt(e),s=-l/(2*i),a=this.range(s,-1,1),o=Math.acos(a),u=2*this.cbrt(i),h=u*this.cos(o/3)-r/3;if(this.abs(h-g)<d)return this.range(h,0,1);const c=u*this.cos((o+2*Math.PI)/3)-r/3;if(this.abs(c-g)<d)return this.range(c,0,1);const _=u*this.cos((o+4*Math.PI)/3)-r/3;return this.range(_,0,1)}if(0==h){let t;t=u<0?this.cbrt(-u):-this.cbrt(u);const e=2*t-r/3;if(this.abs(e-g)<d)return this.range(e,0,1);const i=-t-r/3;return this.range(i,0,1)}const c=this.sqrt(h),_=this.cbrt(c-u)-this.cbrt(c+u)-r/3;return this.range(_,0,1)}constructor(){}};let Dt=Lt;var kt;Dt.Epsilon=1e-5,(kt||(kt={})).CubismMath=Dt;class At{constructor(){this._faceTargetX=0,this._faceTargetY=0,this._faceX=0,this._faceY=0,this._faceVX=0,this._faceVY=0,this._lastTimeSeconds=0,this._userTimeSeconds=0}update(t){this._userTimeSeconds+=t;const e=4/30;if(0==this._lastTimeSeconds)return void(this._lastTimeSeconds=this._userTimeSeconds);const i=30*(this._userTimeSeconds-this._lastTimeSeconds);this._lastTimeSeconds=this._userTimeSeconds;const s=i*e/4.5,r=this._faceTargetX-this._faceX,a=this._faceTargetY-this._faceY;if(Dt.abs(r)<=.01&&Dt.abs(a)<=.01)return;const n=Dt.sqrt(r*r+a*a),o=e*a/n;let l=e*r/n-this._faceVX,u=o-this._faceVY;const h=Dt.sqrt(l*l+u*u);(h<-s||h>s)&&(l*=s/h,u*=s/h),this._faceVX+=l,this._faceVY+=u;{const t=.5*(Dt.sqrt(s*s+16*s*n-8*s*n)-s),e=Dt.sqrt(this._faceVX*this._faceVX+this._faceVY*this._faceVY);e>t&&(this._faceVX*=t/e,this._faceVY*=t/e)}this._faceX+=this._faceVX,this._faceY+=this._faceVY}getX(){return this._faceX}getY(){return this._faceY}set(t,e){this._faceTargetX=t,this._faceTargetY=e}}var Nt,Ot;(Nt||(Nt={})).CubismTargetPoint=At;class zt{constructor(){this.setFinishedMotionHandler=t=>this._onFinishedMotion=t,this.getFinishedMotionHandler=()=>this._onFinishedMotion,this._fadeInSeconds=-1,this._fadeOutSeconds=-1,this._weight=1,this._offsetSeconds=0,this._firedEventValues=new m}static delete(t){t.release(),t=void 0,t=null}release(){this._weight=0}updateParameters(t,e,i){if(!e.isAvailable()||e.isFinished())return;if(!e.isStarted()){e.setIsStarted(!0),e.setStartTime(i-this._offsetSeconds),e.setFadeInStartTime(i);const t=this.getDuration();e.getEndTime()<0&&e.setEndTime(t<=0?-1:e.getStartTime()+t)}let s=this._weight;s=s*(0==this._fadeInSeconds?1:Dt.getEasingSine((i-e.getFadeInStartTime())/this._fadeInSeconds))*(0==this._fadeOutSeconds||e.getEndTime()<0?1:Dt.getEasingSine((e.getEndTime()-i)/this._fadeOutSeconds)),e.setState(i,s),R(0<=s&&s<=1),this.doUpdateParameters(t,i,s,e),e.getEndTime()>0&&e.getEndTime()<i&&e.setIsFinished(!0)}setFadeInTime(t){this._fadeInSeconds=t}setFadeOutTime(t){this._fadeOutSeconds=t}getFadeOutTime(){return this._fadeOutSeconds}getFadeInTime(){return this._fadeInSeconds}setWeight(t){this._weight=t}getWeight(){return this._weight}getDuration(){return-1}getLoopDuration(){return-1}setOffsetTime(t){this._offsetSeconds=t}getFiredEvent(t,e){return this._firedEventValues}}(Ot||(Ot={})).ACubismMotion=zt;class Ut extends zt{static create(t,e){const i=new Ut,s=q.create(t,e),r=s.getRoot();i.setFadeInTime(r.getValueByString("FadeInTime").toFloat(1)),i.setFadeOutTime(r.getValueByString("FadeOutTime").toFloat(1));const a=r.getValueByString("Parameters").getSize();i._parameters.prepareCapacity(a);for(let n=0;n<a;++n){const t=r.getValueByString("Parameters").getValueByIndex(n),e=lt.getIdManager().getId(t.getValueByString("Id").getRawString()),s=t.getValueByString("Value").toFloat();let a;a=t.getValueByString("Blend").isNull()||"Add"==t.getValueByString("Blend").getString()?jt.ExpressionBlendType_Add:"Multiply"==t.getValueByString("Blend").getString()?jt.ExpressionBlendType_Multiply:"Overwrite"==t.getValueByString("Blend").getString()?jt.ExpressionBlendType_Overwrite:jt.ExpressionBlendType_Add;const o=new Kt;o.parameterId=e,o.blendType=a,o.value=s,i._parameters.pushBack(o)}return q.delete(s),i}doUpdateParameters(t,e,i,s){for(let r=0;r<this._parameters.getSize();++r){const e=this._parameters.at(r);switch(e.blendType){case jt.ExpressionBlendType_Add:t.addParameterValueById(e.parameterId,e.value,i);break;case jt.ExpressionBlendType_Multiply:t.multiplyParameterValueById(e.parameterId,e.value,i);break;case jt.ExpressionBlendType_Overwrite:t.setParameterValueById(e.parameterId,e.value,i)}}}constructor(){super(),this._parameters=new m}}var jt,Xt,Gt,Yt,qt,Wt,Ht,Jt;(Xt=jt||(jt={}))[Xt.ExpressionBlendType_Add=0]="ExpressionBlendType_Add",Xt[Xt.ExpressionBlendType_Multiply=1]="ExpressionBlendType_Multiply",Xt[Xt.ExpressionBlendType_Overwrite=2]="ExpressionBlendType_Overwrite";class Kt{}!function(t){t.CubismExpressionMotion=Ut,t.ExpressionBlendType=jt,t.ExpressionParameter=Kt}(Gt||(Gt={})),(qt=Yt||(Yt={}))[qt.CubismMotionCurveTarget_Model=0]="CubismMotionCurveTarget_Model",qt[qt.CubismMotionCurveTarget_Parameter=1]="CubismMotionCurveTarget_Parameter",qt[qt.CubismMotionCurveTarget_PartOpacity=2]="CubismMotionCurveTarget_PartOpacity",(Ht=Wt||(Wt={}))[Ht.CubismMotionSegmentType_Linear=0]="CubismMotionSegmentType_Linear",Ht[Ht.CubismMotionSegmentType_Bezier=1]="CubismMotionSegmentType_Bezier",Ht[Ht.CubismMotionSegmentType_Stepped=2]="CubismMotionSegmentType_Stepped",Ht[Ht.CubismMotionSegmentType_InverseStepped=3]="CubismMotionSegmentType_InverseStepped";class Zt{constructor(){this.time=0,this.value=0}}class Qt{constructor(){this.evaluate=null,this.basePointIndex=0,this.segmentType=0}}class $t{constructor(){this.type=0,this.segmentCount=0,this.baseSegmentIndex=0,this.fadeInTime=0,this.fadeOutTime=0}}class te{constructor(){this.fireTime=0}}class ee{constructor(){this.duration=0,this.loop=!1,this.curveCount=0,this.eventCount=0,this.fps=0,this.curves=new m,this.segments=new m,this.points=new m,this.events=new m}}!function(t){t.CubismMotionCurve=$t,t.CubismMotionCurveTarget=Yt,t.CubismMotionData=ee,t.CubismMotionEvent=te,t.CubismMotionPoint=Zt,t.CubismMotionSegment=Qt,t.CubismMotionSegmentType=Wt}(Jt||(Jt={}));class ie{constructor(t,e){this._json=q.create(t,e)}release(){q.delete(this._json)}getMotionDuration(){return this._json.getRoot().getValueByString("Meta").getValueByString("Duration").toFloat()}isMotionLoop(){return this._json.getRoot().getValueByString("Meta").getValueByString("Loop").toBoolean()}getEvaluationOptionFlag(t){return se.EvaluationOptionFlag_AreBeziersRistricted==t&&this._json.getRoot().getValueByString("Meta").getValueByString("AreBeziersRestricted").toBoolean()}getMotionCurveCount(){return this._json.getRoot().getValueByString("Meta").getValueByString("CurveCount").toInt()}getMotionFps(){return this._json.getRoot().getValueByString("Meta").getValueByString("Fps").toFloat()}getMotionTotalSegmentCount(){return this._json.getRoot().getValueByString("Meta").getValueByString("TotalSegmentCount").toInt()}getMotionTotalPointCount(){return this._json.getRoot().getValueByString("Meta").getValueByString("TotalPointCount").toInt()}isExistMotionFadeInTime(){return!this._json.getRoot().getValueByString("Meta").getValueByString("FadeInTime").isNull()}isExistMotionFadeOutTime(){return!this._json.getRoot().getValueByString("Meta").getValueByString("FadeOutTime").isNull()}getMotionFadeInTime(){return this._json.getRoot().getValueByString("Meta").getValueByString("FadeInTime").toFloat()}getMotionFadeOutTime(){return this._json.getRoot().getValueByString("Meta").getValueByString("FadeOutTime").toFloat()}getMotionCurveTarget(t){return this._json.getRoot().getValueByString("Curves").getValueByIndex(t).getValueByString("Target").getRawString()}getMotionCurveId(t){return lt.getIdManager().getId(this._json.getRoot().getValueByString("Curves").getValueByIndex(t).getValueByString("Id").getRawString())}isExistMotionCurveFadeInTime(t){return!this._json.getRoot().getValueByString("Curves").getValueByIndex(t).getValueByString("FadeInTime").isNull()}isExistMotionCurveFadeOutTime(t){return!this._json.getRoot().getValueByString("Curves").getValueByIndex(t).getValueByString("FadeOutTime").isNull()}getMotionCurveFadeInTime(t){return this._json.getRoot().getValueByString("Curves").getValueByIndex(t).getValueByString("FadeInTime").toFloat()}getMotionCurveFadeOutTime(t){return this._json.getRoot().getValueByString("Curves").getValueByIndex(t).getValueByString("FadeOutTime").toFloat()}getMotionCurveSegmentCount(t){return this._json.getRoot().getValueByString("Curves").getValueByIndex(t).getValueByString("Segments").getVector().getSize()}getMotionCurveSegment(t,e){return this._json.getRoot().getValueByString("Curves").getValueByIndex(t).getValueByString("Segments").getValueByIndex(e).toFloat()}getEventCount(){return this._json.getRoot().getValueByString("Meta").getValueByString("UserDataCount").toInt()}getTotalEventValueSize(){return this._json.getRoot().getValueByString("Meta").getValueByString("TotalUserDataSize").toInt()}getEventTime(t){return this._json.getRoot().getValueByString("UserData").getValueByIndex(t).getValueByString("Time").toFloat()}getEventValue(t){return new b(this._json.getRoot().getValueByString("UserData").getValueByIndex(t).getValueByString("Value").getRawString())}}var se,re,ae;(re=se||(se={}))[re.EvaluationOptionFlag_AreBeziersRistricted=0]="EvaluationOptionFlag_AreBeziersRistricted",(ae||(ae={})).CubismMotionJson=ie;function ne(t,e,i){const s=new Zt;return s.time=t.time+(e.time-t.time)*i,s.value=t.value+(e.value-t.value)*i,s}function oe(t,e){let i=(e-t[0].time)/(t[1].time-t[0].time);return i<0&&(i=0),t[0].value+(t[1].value-t[0].value)*i}function le(t,e){let i=(e-t[0].time)/(t[3].time-t[0].time);i<0&&(i=0);const s=ne(t[0],t[1],i),r=ne(t[1],t[2],i),a=ne(t[2],t[3],i),n=ne(s,r,i),o=ne(r,a,i);return ne(n,o,i).value}function ue(t,e){const i=e,s=t[0].time,r=t[3].time,a=t[1].time,n=t[2].time,o=r-3*n+3*a-s,l=3*n-6*a+3*s,u=3*a-3*s,h=s-i,g=Dt.cardanoAlgorithmForBezier(o,l,u,h),d=ne(t[0],t[1],g),c=ne(t[1],t[2],g),_=ne(t[2],t[3],g),m=ne(d,c,g),p=ne(c,_,g);return ne(m,p,g).value}function he(t,e){return t[0].value}function ge(t,e){return t[1].value}function de(t,e,i){const s=t.curves.at(e);let r=-1;const a=s.baseSegmentIndex+s.segmentCount;let n=0;for(let l=s.baseSegmentIndex;l<a;++l)if(n=t.segments.at(l).basePointIndex+(t.segments.at(l).segmentType==Wt.CubismMotionSegmentType_Bezier?3:1),t.points.at(n).time>i){r=l;break}if(-1==r)return t.points.at(n).value;const o=t.segments.at(r);return o.evaluate(t.points.get(o.basePointIndex),i)}class ce extends zt{static create(t,e,i){const s=new ce;return s.parse(t,e),s._sourceFrameRate=s._motionData.fps,s._loopDurationSeconds=s._motionData.duration,s._onFinishedMotion=i,s}doUpdateParameters(t,e,i,s){null==this._modelCurveIdEyeBlink&&(this._modelCurveIdEyeBlink=lt.getIdManager().getId("EyeBlink")),null==this._modelCurveIdLipSync&&(this._modelCurveIdLipSync=lt.getIdManager().getId("LipSync"));let r=e-s.getStartTime();r<0&&(r=0);let a=Number.MAX_VALUE,n=Number.MAX_VALUE;const o=64;let l=0,u=0;this._eyeBlinkParameterIds.getSize()>o&&L("too many eye blink targets : {0}",this._eyeBlinkParameterIds.getSize()),this._lipSyncParameterIds.getSize()>o&&L("too many lip sync targets : {0}",this._lipSyncParameterIds.getSize());const h=this._fadeInSeconds<=0?1:Dt.getEasingSine((e-s.getFadeInStartTime())/this._fadeInSeconds),g=this._fadeOutSeconds<=0||s.getEndTime()<0?1:Dt.getEasingSine((s.getEndTime()-e)/this._fadeOutSeconds);let d,c,_,m=r;if(this._isLoop)for(;m>this._motionData.duration;)m-=this._motionData.duration;const p=this._motionData.curves;for(c=0;c<this._motionData.curveCount&&p.at(c).type==Yt.CubismMotionCurveTarget_Model;++c)d=de(this._motionData,c,m),p.at(c).id==this._modelCurveIdEyeBlink?n=d:p.at(c).id==this._modelCurveIdLipSync&&(a=d);for(;c<this._motionData.curveCount&&p.at(c).type==Yt.CubismMotionCurveTarget_Parameter;++c){if(_=t.getParameterIndex(p.at(c).id),-1==_)continue;const r=t.getParameterValueByIndex(_);if(d=de(this._motionData,c,m),n!=Number.MAX_VALUE)for(let t=0;t<this._eyeBlinkParameterIds.getSize()&&t<o;++t)if(this._eyeBlinkParameterIds.at(t)==p.at(c).id){d*=n,u|=1<<t;break}if(a!=Number.MAX_VALUE)for(let t=0;t<this._lipSyncParameterIds.getSize()&&t<o;++t)if(this._lipSyncParameterIds.at(t)==p.at(c).id){d+=a,l|=1<<t;break}let y;if(p.at(c).fadeInTime<0&&p.at(c).fadeOutTime<0)y=r+(d-r)*i;else{let t,i;t=p.at(c).fadeInTime<0?h:0==p.at(c).fadeInTime?1:Dt.getEasingSine((e-s.getFadeInStartTime())/p.at(c).fadeInTime),i=p.at(c).fadeOutTime<0?g:0==p.at(c).fadeOutTime||s.getEndTime()<0?1:Dt.getEasingSine((s.getEndTime()-e)/p.at(c).fadeOutTime);y=r+(d-r)*(this._weight*t*i)}t.setParameterValueByIndex(_,y,1)}if(n!=Number.MAX_VALUE)for(let y=0;y<this._eyeBlinkParameterIds.getSize()&&y<o;++y){const e=t.getParameterValueById(this._eyeBlinkParameterIds.at(y));if(u>>y&1)continue;const s=e+(n-e)*i;t.setParameterValueById(this._eyeBlinkParameterIds.at(y),s)}if(a!=Number.MAX_VALUE)for(let y=0;y<this._lipSyncParameterIds.getSize()&&y<o;++y){const e=t.getParameterValueById(this._lipSyncParameterIds.at(y));if(l>>y&1)continue;const s=e+(a-e)*i;t.setParameterValueById(this._lipSyncParameterIds.at(y),s)}for(;c<this._motionData.curveCount&&p.at(c).type==Yt.CubismMotionCurveTarget_PartOpacity;++c)_=t.getParameterIndex(p.at(c).id),-1!=_&&(d=de(this._motionData,c,m),t.setParameterValueByIndex(_,d));r>=this._motionData.duration&&(this._isLoop?(s.setStartTime(e),this._isLoopFadeIn&&s.setFadeInStartTime(e)):(this._onFinishedMotion&&this._onFinishedMotion(this),s.setIsFinished(!0))),this._lastWeight=i}setIsLoop(t){this._isLoop=t}isLoop(){return this._isLoop}setIsLoopFadeIn(t){this._isLoopFadeIn=t}isLoopFadeIn(){return this._isLoopFadeIn}getDuration(){return this._isLoop?-1:this._loopDurationSeconds}getLoopDuration(){return this._loopDurationSeconds}setParameterFadeInTime(t,e){const i=this._motionData.curves;for(let s=0;s<this._motionData.curveCount;++s)if(t==i.at(s).id)return void(i.at(s).fadeInTime=e)}setParameterFadeOutTime(t,e){const i=this._motionData.curves;for(let s=0;s<this._motionData.curveCount;++s)if(t==i.at(s).id)return void(i.at(s).fadeOutTime=e)}getParameterFadeInTime(t){const e=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==e.at(i).id)return e.at(i).fadeInTime;return-1}getParameterFadeOutTime(t){const e=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==e.at(i).id)return e.at(i).fadeOutTime;return-1}setEffectIds(t,e){this._eyeBlinkParameterIds=t,this._lipSyncParameterIds=e}constructor(){super(),this._sourceFrameRate=30,this._loopDurationSeconds=-1,this._isLoop=!1,this._isLoopFadeIn=!0,this._lastWeight=0,this._motionData=null,this._modelCurveIdEyeBlink=null,this._modelCurveIdLipSync=null,this._eyeBlinkParameterIds=null,this._lipSyncParameterIds=null}release(){this._motionData=void 0,this._motionData=null}parse(t,e){this._motionData=new ee;let i=new ie(t,e);this._motionData.duration=i.getMotionDuration(),this._motionData.loop=i.isMotionLoop(),this._motionData.curveCount=i.getMotionCurveCount(),this._motionData.fps=i.getMotionFps(),this._motionData.eventCount=i.getEventCount();const s=i.getEvaluationOptionFlag(se.EvaluationOptionFlag_AreBeziersRistricted);i.isExistMotionFadeInTime()?this._fadeInSeconds=i.getMotionFadeInTime()<0?1:i.getMotionFadeInTime():this._fadeInSeconds=1,i.isExistMotionFadeOutTime()?this._fadeOutSeconds=i.getMotionFadeOutTime()<0?1:i.getMotionFadeOutTime():this._fadeOutSeconds=1,this._motionData.curves.updateSize(this._motionData.curveCount,$t,!0),this._motionData.segments.updateSize(i.getMotionTotalSegmentCount(),Qt,!0),this._motionData.points.updateSize(i.getMotionTotalPointCount(),Zt,!0),this._motionData.events.updateSize(this._motionData.eventCount,te,!0);let r=0,a=0;for(let n=0;n<this._motionData.curveCount;++n){"Model"==i.getMotionCurveTarget(n)?this._motionData.curves.at(n).type=Yt.CubismMotionCurveTarget_Model:"Parameter"==i.getMotionCurveTarget(n)?this._motionData.curves.at(n).type=Yt.CubismMotionCurveTarget_Parameter:"PartOpacity"==i.getMotionCurveTarget(n)&&(this._motionData.curves.at(n).type=Yt.CubismMotionCurveTarget_PartOpacity),this._motionData.curves.at(n).id=i.getMotionCurveId(n),this._motionData.curves.at(n).baseSegmentIndex=a,this._motionData.curves.at(n).fadeInTime=i.isExistMotionCurveFadeInTime(n)?i.getMotionCurveFadeInTime(n):-1,this._motionData.curves.at(n).fadeOutTime=i.isExistMotionCurveFadeOutTime(n)?i.getMotionCurveFadeOutTime(n):-1;for(let t=0;t<i.getMotionCurveSegmentCount(n);){0==t?(this._motionData.segments.at(a).basePointIndex=r,this._motionData.points.at(r).time=i.getMotionCurveSegment(n,t),this._motionData.points.at(r).value=i.getMotionCurveSegment(n,t+1),r+=1,t+=2):this._motionData.segments.at(a).basePointIndex=r-1;switch(i.getMotionCurveSegment(n,t)){case Wt.CubismMotionSegmentType_Linear:this._motionData.segments.at(a).segmentType=Wt.CubismMotionSegmentType_Linear,this._motionData.segments.at(a).evaluate=oe,this._motionData.points.at(r).time=i.getMotionCurveSegment(n,t+1),this._motionData.points.at(r).value=i.getMotionCurveSegment(n,t+2),r+=1,t+=3;break;case Wt.CubismMotionSegmentType_Bezier:this._motionData.segments.at(a).segmentType=Wt.CubismMotionSegmentType_Bezier,this._motionData.segments.at(a).evaluate=s?le:ue,this._motionData.points.at(r).time=i.getMotionCurveSegment(n,t+1),this._motionData.points.at(r).value=i.getMotionCurveSegment(n,t+2),this._motionData.points.at(r+1).time=i.getMotionCurveSegment(n,t+3),this._motionData.points.at(r+1).value=i.getMotionCurveSegment(n,t+4),this._motionData.points.at(r+2).time=i.getMotionCurveSegment(n,t+5),this._motionData.points.at(r+2).value=i.getMotionCurveSegment(n,t+6),r+=3,t+=7;break;case Wt.CubismMotionSegmentType_Stepped:this._motionData.segments.at(a).segmentType=Wt.CubismMotionSegmentType_Stepped,this._motionData.segments.at(a).evaluate=he,this._motionData.points.at(r).time=i.getMotionCurveSegment(n,t+1),this._motionData.points.at(r).value=i.getMotionCurveSegment(n,t+2),r+=1,t+=3;break;case Wt.CubismMotionSegmentType_InverseStepped:this._motionData.segments.at(a).segmentType=Wt.CubismMotionSegmentType_InverseStepped,this._motionData.segments.at(a).evaluate=ge,this._motionData.points.at(r).time=i.getMotionCurveSegment(n,t+1),this._motionData.points.at(r).value=i.getMotionCurveSegment(n,t+2),r+=1,t+=3;break;default:R(0)}++this._motionData.curves.at(n).segmentCount,++a}}for(let n=0;n<i.getEventCount();++n)this._motionData.events.at(n).fireTime=i.getEventTime(n),this._motionData.events.at(n).value=i.getEventValue(n);i.release(),i=void 0,i=null}getFiredEvent(t,e){this._firedEventValues.updateSize(0);for(let i=0;i<this._motionData.eventCount;++i)this._motionData.events.at(i).fireTime>t&&this._motionData.events.at(i).fireTime<=e&&this._firedEventValues.pushBack(new b(this._motionData.events.at(i).value.s));return this._firedEventValues}}var _e,me;(_e||(_e={})).CubismMotion=ce;class pe{constructor(){this._autoDelete=!1,this._motion=null,this._available=!0,this._finished=!1,this._started=!1,this._startTimeSeconds=-1,this._fadeInStartTimeSeconds=0,this._endTimeSeconds=-1,this._stateTimeSeconds=0,this._stateWeight=0,this._lastEventCheckSeconds=0,this._motionQueueEntryHandle=this,this._fadeOutSeconds=0,this._isTriggeredFadeOut=!1}release(){this._autoDelete&&this._motion&&zt.delete(this._motion)}setFadeOut(t){this._fadeOutSeconds=t,this._isTriggeredFadeOut=!0}startFadeOut(t,e){const i=e+t;this._isTriggeredFadeOut=!0,(this._endTimeSeconds<0||i<this._endTimeSeconds)&&(this._endTimeSeconds=i)}isFinished(){return this._finished}isStarted(){return this._started}getStartTime(){return this._startTimeSeconds}getFadeInStartTime(){return this._fadeInStartTimeSeconds}getEndTime(){return this._endTimeSeconds}setStartTime(t){this._startTimeSeconds=t}setFadeInStartTime(t){this._fadeInStartTimeSeconds=t}setEndTime(t){this._endTimeSeconds=t}setIsFinished(t){this._finished=t}setIsStarted(t){this._started=t}isAvailable(){return this._available}setIsAvailable(t){this._available=t}setState(t,e){this._stateTimeSeconds=t,this._stateWeight=e}getStateTime(){return this._stateTimeSeconds}getStateWeight(){return this._stateWeight}getLastCheckEventSeconds(){return this._lastEventCheckSeconds}setLastCheckEventSeconds(t){this._lastEventCheckSeconds=t}isTriggeredFadeOut(){return this._isTriggeredFadeOut&&this._endTimeSeconds<0}getFadeOutSeconds(){return this._fadeOutSeconds}}(me||(me={})).CubismMotionQueueEntry=pe;class ye{constructor(){this._userTimeSeconds=0,this._eventCallBack=null,this._eventCustomData=null,this._motions=new m}release(){for(let t=0;t<this._motions.getSize();++t)this._motions.at(t)&&(this._motions.at(t).release(),this._motions.set(t,void 0),this._motions.set(t,null));this._motions=null}startMotion(t,e,i){if(null==t)return Se;let s=null;for(let r=0;r<this._motions.getSize();++r)s=this._motions.at(r),null!=s&&s.setFadeOut(s._motion.getFadeOutTime());return s=new pe,s._autoDelete=e,s._motion=t,this._motions.pushBack(s),s._motionQueueEntryHandle}isFinished(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();if(null==e){t=this._motions.erase(t);continue}if(null!=e._motion){if(!e.isFinished())return!1;t.preIncrement()}else e.release(),e=void 0,e=null,t=this._motions.erase(t)}return!0}isFinishedByHandle(t){for(let e=this._motions.begin();e.notEqual(this._motions.end());e.increment()){const i=e.ptr();if(null!=i&&(i._motionQueueEntryHandle==t&&!i.isFinished()))return!1}return!0}stopAllMotions(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();null!=e?(e.release(),e=void 0,e=null,t=this._motions.erase(t)):t=this._motions.erase(t)}}getCubismMotionQueueEntry(t){for(let e=this._motions.begin();e.notEqual(this._motions.end());e.preIncrement()){const i=e.ptr();if(null!=i&&i._motionQueueEntryHandle==t)return i}return null}setEventCallback(t,e=null){this._eventCallBack=t,this._eventCustomData=e}doUpdateMotion(t,e){let i=!1;for(let s=this._motions.begin();s.notEqual(this._motions.end());){let r=s.ptr();if(null==r){s=this._motions.erase(s);continue}const a=r._motion;if(null==a){r.release(),r=void 0,r=null,s=this._motions.erase(s);continue}a.updateParameters(t,r,e),i=!0;const n=a.getFiredEvent(r.getLastCheckEventSeconds()-r.getStartTime(),e-r.getStartTime());for(let t=0;t<n.getSize();++t)this._eventCallBack(this,n.at(t),this._eventCustomData);r.setLastCheckEventSeconds(e),r.isFinished()?(r.release(),r=void 0,r=null,s=this._motions.erase(s)):(r.isTriggeredFadeOut()&&r.startFadeOut(r.getFadeOutSeconds(),e),s.preIncrement())}return i}}const Se=-1;var fe,xe,Ce,Be,Me,Ve,Ie;!function(t){t.CubismMotionQueueManager=ye,t.InvalidMotionQueueEntryHandleValue=Se}(fe||(fe={}));class be extends ye{constructor(){super(),this._currentPriority=0,this._reservePriority=0}getCurrentPriority(){return this._currentPriority}getReservePriority(){return this._reservePriority}setReservePriority(t){this._reservePriority=t}startMotionPriority(t,e,i){return i==this._reservePriority&&(this._reservePriority=0),this._currentPriority=i,super.startMotion(t,e,this._userTimeSeconds)}updateMotion(t,e){this._userTimeSeconds+=e;const i=super.doUpdateMotion(t,this._userTimeSeconds);return this.isFinished()&&(this._currentPriority=0),i}reserveMotion(t){return!(t<=this._reservePriority||t<=this._currentPriority)&&(this._reservePriority=t,!0)}}(xe||(xe={})).CubismMotionManager=be,(Be=Ce||(Ce={}))[Be.CubismPhysicsTargetType_Parameter=0]="CubismPhysicsTargetType_Parameter",(Ve=Me||(Me={}))[Ve.CubismPhysicsSource_X=0]="CubismPhysicsSource_X",Ve[Ve.CubismPhysicsSource_Y=1]="CubismPhysicsSource_Y",Ve[Ve.CubismPhysicsSource_Angle=2]="CubismPhysicsSource_Angle";class ve{constructor(){this.gravity=new Rt(0,0),this.wind=new Rt(0,0)}}class Pe{}class we{}class Ee{constructor(){this.initialPosition=new Rt(0,0),this.position=new Rt(0,0),this.lastPosition=new Rt(0,0),this.lastGravity=new Rt(0,0),this.force=new Rt(0,0),this.velocity=new Rt(0,0)}}class Te{constructor(){this.normalizationPosition=new we,this.normalizationAngle=new we}}class Fe{constructor(){this.source=new Pe}}class Re{constructor(){this.destination=new Pe,this.translationScale=new Rt(0,0)}}class Le{constructor(){this.settings=new m,this.inputs=new m,this.outputs=new m,this.particles=new m,this.gravity=new Rt(0,0),this.wind=new Rt(0,0)}}!function(t){t.CubismPhysicsInput=Fe,t.CubismPhysicsNormalization=we,t.CubismPhysicsOutput=Re,t.CubismPhysicsParameter=Pe,t.CubismPhysicsParticle=Ee,t.CubismPhysicsRig=Le,t.CubismPhysicsSource=Me,t.CubismPhysicsSubRig=Te,t.CubismPhysicsTargetType=Ce,t.PhysicsJsonEffectiveForces=ve}(Ie||(Ie={}));const De="PhysicsSettings";class ke{constructor(t,e){this._json=q.create(t,e)}release(){q.delete(this._json)}getGravity(){const t=new Rt(0,0);return t.x=this._json.getRoot().getValueByString("Meta").getValueByString("EffectiveForces").getValueByString("Gravity").getValueByString("X").toFloat(),t.y=this._json.getRoot().getValueByString("Meta").getValueByString("EffectiveForces").getValueByString("Gravity").getValueByString("Y").toFloat(),t}getWind(){const t=new Rt(0,0);return t.x=this._json.getRoot().getValueByString("Meta").getValueByString("EffectiveForces").getValueByString("Wind").getValueByString("X").toFloat(),t.y=this._json.getRoot().getValueByString("Meta").getValueByString("EffectiveForces").getValueByString("Wind").getValueByString("Y").toFloat(),t}getSubRigCount(){return this._json.getRoot().getValueByString("Meta").getValueByString("PhysicsSettingCount").toInt()}getTotalInputCount(){return this._json.getRoot().getValueByString("Meta").getValueByString("TotalInputCount").toInt()}getTotalOutputCount(){return this._json.getRoot().getValueByString("Meta").getValueByString("TotalOutputCount").toInt()}getVertexCount(){return this._json.getRoot().getValueByString("Meta").getValueByString("VertexCount").toInt()}getNormalizationPositionMinimumValue(t){return this._json.getRoot().getValueByString(De).getValueByIndex(t).getValueByString("Normalization").getValueByString("Position").getValueByString("Minimum").toFloat()}getNormalizationPositionMaximumValue(t){return this._json.getRoot().getValueByString(De).getValueByIndex(t).getValueByString("Normalization").getValueByString("Position").getValueByString("Maximum").toFloat()}getNormalizationPositionDefaultValue(t){return this._json.getRoot().getValueByString(De).getValueByIndex(t).getValueByString("Normalization").getValueByString("Position").getValueByString("Default").toFloat()}getNormalizationAngleMinimumValue(t){return this._json.getRoot().getValueByString(De).getValueByIndex(t).getValueByString("Normalization").getValueByString("Angle").getValueByString("Minimum").toFloat()}getNormalizationAngleMaximumValue(t){return this._json.getRoot().getValueByString(De).getValueByIndex(t).getValueByString("Normalization").getValueByString("Angle").getValueByString("Maximum").toFloat()}getNormalizationAngleDefaultValue(t){return this._json.getRoot().getValueByString(De).getValueByIndex(t).getValueByString("Normalization").getValueByString("Angle").getValueByString("Default").toFloat()}getInputCount(t){return this._json.getRoot().getValueByString(De).getValueByIndex(t).getValueByString("Input").getVector().getSize()}getInputWeight(t,e){return this._json.getRoot().getValueByString(De).getValueByIndex(t).getValueByString("Input").getValueByIndex(e).getValueByString("Weight").toFloat()}getInputReflect(t,e){return this._json.getRoot().getValueByString(De).getValueByIndex(t).getValueByString("Input").getValueByIndex(e).getValueByString("Reflect").toBoolean()}getInputType(t,e){return this._json.getRoot().getValueByString(De).getValueByIndex(t).getValueByString("Input").getValueByIndex(e).getValueByString("Type").getRawString()}getInputSourceId(t,e){return lt.getIdManager().getId(this._json.getRoot().getValueByString(De).getValueByIndex(t).getValueByString("Input").getValueByIndex(e).getValueByString("Source").getValueByString("Id").getRawString())}getOutputCount(t){return this._json.getRoot().getValueByString(De).getValueByIndex(t).getValueByString("Output").getVector().getSize()}getOutputVertexIndex(t,e){return this._json.getRoot().getValueByString(De).getValueByIndex(t).getValueByString("Output").getValueByIndex(e).getValueByString("VertexIndex").toInt()}getOutputAngleScale(t,e){return this._json.getRoot().getValueByString(De).getValueByIndex(t).getValueByString("Output").getValueByIndex(e).getValueByString("Scale").toFloat()}getOutputWeight(t,e){return this._json.getRoot().getValueByString(De).getValueByIndex(t).getValueByString("Output").getValueByIndex(e).getValueByString("Weight").toFloat()}getOutputDestinationId(t,e){return lt.getIdManager().getId(this._json.getRoot().getValueByString(De).getValueByIndex(t).getValueByString("Output").getValueByIndex(e).getValueByString("Destination").getValueByString("Id").getRawString())}getOutputType(t,e){return this._json.getRoot().getValueByString(De).getValueByIndex(t).getValueByString("Output").getValueByIndex(e).getValueByString("Type").getRawString()}getOutputReflect(t,e){return this._json.getRoot().getValueByString(De).getValueByIndex(t).getValueByString("Output").getValueByIndex(e).getValueByString("Reflect").toBoolean()}getParticleCount(t){return this._json.getRoot().getValueByString(De).getValueByIndex(t).getValueByString("Vertices").getVector().getSize()}getParticleMobility(t,e){return this._json.getRoot().getValueByString(De).getValueByIndex(t).getValueByString("Vertices").getValueByIndex(e).getValueByString("Mobility").toFloat()}getParticleDelay(t,e){return this._json.getRoot().getValueByString(De).getValueByIndex(t).getValueByString("Vertices").getValueByIndex(e).getValueByString("Delay").toFloat()}getParticleAcceleration(t,e){return this._json.getRoot().getValueByString(De).getValueByIndex(t).getValueByString("Vertices").getValueByIndex(e).getValueByString("Acceleration").toFloat()}getParticleRadius(t,e){return this._json.getRoot().getValueByString(De).getValueByIndex(t).getValueByString("Vertices").getValueByIndex(e).getValueByString("Radius").toFloat()}getParticlePosition(t,e){const i=new Rt(0,0);return i.x=this._json.getRoot().getValueByString(De).getValueByIndex(t).getValueByString("Vertices").getValueByIndex(e).getValueByString("Position").getValueByString("X").toFloat(),i.y=this._json.getRoot().getValueByString(De).getValueByIndex(t).getValueByString("Vertices").getValueByIndex(e).getValueByString("Position").getValueByString("Y").toFloat(),i}}var Ae;(Ae||(Ae={})).CubismPhysicsJson=ke;class Ne{static create(t,e){const i=new Ne;return i.parse(t,e),i._physicsRig.gravity.y=0,i}static delete(t){null!=t&&(t.release(),t=null)}evaluate(t,e){let i,s,r,a;const n=new Rt;let o,l,u,h,g,d,c,_;g=t.getModel().parameters.values,d=t.getModel().parameters.maximumValues,c=t.getModel().parameters.minimumValues,_=t.getModel().parameters.defaultValues;for(let m=0;m<this._physicsRig.subRigCount;++m){i={angle:0},n.x=0,n.y=0,o=this._physicsRig.settings.at(m),l=this._physicsRig.inputs.get(o.baseInputIndex),u=this._physicsRig.outputs.get(o.baseOutputIndex),h=this._physicsRig.particles.get(o.baseParticleIndex);for(let e=0;e<o.inputCount;++e)s=l[e].weight/100,-1==l[e].sourceParameterIndex&&(l[e].sourceParameterIndex=t.getParameterIndex(l[e].source.id)),l[e].getNormalizedParameterValue(n,i,g[l[e].sourceParameterIndex],c[l[e].sourceParameterIndex],d[l[e].sourceParameterIndex],_[l[e].sourceParameterIndex],o.normalizationPosition,o.normalizationAngle,l[e].reflect,s);r=Dt.degreesToRadian(-i.angle),n.x=n.x*Dt.cos(r)-n.y*Dt.sin(r),n.y=n.x*Dt.sin(r)+n.y*Dt.cos(r),Ke(h,o.particleCount,n,i.angle,this._options.wind,.001*o.normalizationPosition.maximum,e,5);for(let e=0;e<o.outputCount;++e){const i=u[e].vertexIndex;if(i<1||i>=o.particleCount)break;-1==u[e].destinationParameterIndex&&(u[e].destinationParameterIndex=t.getParameterIndex(u[e].destination.id));const s=new Rt;s.x=h[i].position.x-h[i-1].position.x,s.y=h[i].position.y-h[i-1].position.y,a=u[e].getValue(s,h,i,u[e].reflect,this._options.gravity);const r=u[e].destinationParameterIndex,n=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(g.subarray(r))):g.slice(r);Ze(n,c[r],d[r],a,u[e]);for(let t=r,e=0;t<g.length;t++,e++)g[t]=n[e]}}}setOptions(t){this._options=t}getOption(){return this._options}constructor(){this._physicsRig=null,this._options=new Oe,this._options.gravity.y=-1,this._options.gravity.x=0,this._options.wind.x=0,this._options.wind.y=0}release(){this._physicsRig=void 0,this._physicsRig=null}parse(t,e){this._physicsRig=new Le;let i=new ke(t,e);this._physicsRig.gravity=i.getGravity(),this._physicsRig.wind=i.getWind(),this._physicsRig.subRigCount=i.getSubRigCount(),this._physicsRig.settings.updateSize(this._physicsRig.subRigCount,Te,!0),this._physicsRig.inputs.updateSize(i.getTotalInputCount(),Fe,!0),this._physicsRig.outputs.updateSize(i.getTotalOutputCount(),Re,!0),this._physicsRig.particles.updateSize(i.getVertexCount(),Ee,!0);let s=0,r=0,a=0;for(let n=0;n<this._physicsRig.settings.getSize();++n){this._physicsRig.settings.at(n).normalizationPosition.minimum=i.getNormalizationPositionMinimumValue(n),this._physicsRig.settings.at(n).normalizationPosition.maximum=i.getNormalizationPositionMaximumValue(n),this._physicsRig.settings.at(n).normalizationPosition.defalut=i.getNormalizationPositionDefaultValue(n),this._physicsRig.settings.at(n).normalizationAngle.minimum=i.getNormalizationAngleMinimumValue(n),this._physicsRig.settings.at(n).normalizationAngle.maximum=i.getNormalizationAngleMaximumValue(n),this._physicsRig.settings.at(n).normalizationAngle.defalut=i.getNormalizationAngleDefaultValue(n),this._physicsRig.settings.at(n).inputCount=i.getInputCount(n),this._physicsRig.settings.at(n).baseInputIndex=s;for(let t=0;t<this._physicsRig.settings.at(n).inputCount;++t)this._physicsRig.inputs.at(s+t).sourceParameterIndex=-1,this._physicsRig.inputs.at(s+t).weight=i.getInputWeight(n,t),this._physicsRig.inputs.at(s+t).reflect=i.getInputReflect(n,t),"X"==i.getInputType(n,t)?(this._physicsRig.inputs.at(s+t).type=Me.CubismPhysicsSource_X,this._physicsRig.inputs.at(s+t).getNormalizedParameterValue=ze):"Y"==i.getInputType(n,t)?(this._physicsRig.inputs.at(s+t).type=Me.CubismPhysicsSource_Y,this._physicsRig.inputs.at(s+t).getNormalizedParameterValue=Ue):"Angle"==i.getInputType(n,t)&&(this._physicsRig.inputs.at(s+t).type=Me.CubismPhysicsSource_Angle,this._physicsRig.inputs.at(s+t).getNormalizedParameterValue=je),this._physicsRig.inputs.at(s+t).source.targetType=Ce.CubismPhysicsTargetType_Parameter,this._physicsRig.inputs.at(s+t).source.id=i.getInputSourceId(n,t);s+=this._physicsRig.settings.at(n).inputCount,this._physicsRig.settings.at(n).outputCount=i.getOutputCount(n),this._physicsRig.settings.at(n).baseOutputIndex=r;for(let t=0;t<this._physicsRig.settings.at(n).outputCount;++t)this._physicsRig.outputs.at(r+t).destinationParameterIndex=-1,this._physicsRig.outputs.at(r+t).vertexIndex=i.getOutputVertexIndex(n,t),this._physicsRig.outputs.at(r+t).angleScale=i.getOutputAngleScale(n,t),this._physicsRig.outputs.at(r+t).weight=i.getOutputWeight(n,t),this._physicsRig.outputs.at(r+t).destination.targetType=Ce.CubismPhysicsTargetType_Parameter,this._physicsRig.outputs.at(r+t).destination.id=i.getOutputDestinationId(n,t),"X"==i.getOutputType(n,t)?(this._physicsRig.outputs.at(r+t).type=Me.CubismPhysicsSource_X,this._physicsRig.outputs.at(r+t).getValue=Xe,this._physicsRig.outputs.at(r+t).getScale=We):"Y"==i.getOutputType(n,t)?(this._physicsRig.outputs.at(r+t).type=Me.CubismPhysicsSource_Y,this._physicsRig.outputs.at(r+t).getValue=Ge,this._physicsRig.outputs.at(r+t).getScale=He):"Angle"==i.getOutputType(n,t)&&(this._physicsRig.outputs.at(r+t).type=Me.CubismPhysicsSource_Angle,this._physicsRig.outputs.at(r+t).getValue=Ye,this._physicsRig.outputs.at(r+t).getScale=Je),this._physicsRig.outputs.at(r+t).reflect=i.getOutputReflect(n,t);r+=this._physicsRig.settings.at(n).outputCount,this._physicsRig.settings.at(n).particleCount=i.getParticleCount(n),this._physicsRig.settings.at(n).baseParticleIndex=a;for(let t=0;t<this._physicsRig.settings.at(n).particleCount;++t)this._physicsRig.particles.at(a+t).mobility=i.getParticleMobility(n,t),this._physicsRig.particles.at(a+t).delay=i.getParticleDelay(n,t),this._physicsRig.particles.at(a+t).acceleration=i.getParticleAcceleration(n,t),this._physicsRig.particles.at(a+t).radius=i.getParticleRadius(n,t),this._physicsRig.particles.at(a+t).position=i.getParticlePosition(n,t);a+=this._physicsRig.settings.at(n).particleCount}this.initialize(),i.release(),i=void 0,i=null}initialize(){let t,e,i;for(let s=0;s<this._physicsRig.subRigCount;++s){e=this._physicsRig.settings.at(s),t=this._physicsRig.particles.get(e.baseParticleIndex),t[0].initialPosition=new Rt(0,0),t[0].lastPosition=new Rt(t[0].initialPosition.x,t[0].initialPosition.y),t[0].lastGravity=new Rt(0,-1),t[0].lastGravity.y*=-1,t[0].velocity=new Rt(0,0),t[0].force=new Rt(0,0);for(let s=1;s<e.particleCount;++s)i=new Rt(0,0),i.y=t[s].radius,t[s].initialPosition=new Rt(t[s-1].initialPosition.x+i.x,t[s-1].initialPosition.y+i.y),t[s].position=new Rt(t[s].initialPosition.x,t[s].initialPosition.y),t[s].lastPosition=new Rt(t[s].initialPosition.x,t[s].initialPosition.y),t[s].lastGravity=new Rt(0,-1),t[s].lastGravity.y*=-1,t[s].velocity=new Rt(0,0),t[s].force=new Rt(0,0)}}}class Oe{constructor(){this.gravity=new Rt(0,0),this.wind=new Rt(0,0)}}function ze(t,e,i,s,r,a,n,o,l,u){t.x+=Qe(i,s,r,a,n.minimum,n.maximum,n.defalut,l)*u}function Ue(t,e,i,s,r,a,n,o,l,u){t.y+=Qe(i,s,r,a,n.minimum,n.maximum,n.defalut,l)*u}function je(t,e,i,s,r,a,n,o,l,u){e.angle+=Qe(i,s,r,a,o.minimum,o.maximum,o.defalut,l)*u}function Xe(t,e,i,s,r){let a=t.x;return s&&(a*=-1),a}function Ge(t,e,i,s,r){let a=t.y;return s&&(a*=-1),a}function Ye(t,e,i,s,r){let a;return r=i>=2?e[i-1].position.substract(e[i-2].position):r.multiplyByScaler(-1),a=Dt.directionToRadian(r,t),s&&(a*=-1),a}function qe(t,e){return Dt.min(t,e)+function(t,e){const i=Dt.max(t,e),s=Dt.min(t,e);return Dt.abs(i-s)}(t,e)/2}function We(t,e){return JSON.parse(JSON.stringify(t.x))}function He(t,e){return JSON.parse(JSON.stringify(t.y))}function Je(t,e){return JSON.parse(JSON.stringify(e))}function Ke(t,e,i,s,r,a,n,o){let l,u,h,g,d=new Rt(0,0),c=new Rt(0,0),_=new Rt(0,0),m=new Rt(0,0);t[0].position=new Rt(i.x,i.y),l=Dt.degreesToRadian(s),g=Dt.radianToDirection(l),g.normalize();for(let p=1;p<e;++p)t[p].force=g.multiplyByScaler(t[p].acceleration).add(r),t[p].lastPosition=new Rt(t[p].position.x,t[p].position.y),u=t[p].delay*n*30,d=t[p].position.substract(t[p-1].position),h=Dt.directionToRadian(t[p].lastGravity,g)/o,d.x=Dt.cos(h)*d.x-d.y*Dt.sin(h),d.y=Dt.sin(h)*d.x+d.y*Dt.cos(h),t[p].position=t[p-1].position.add(d),c=t[p].velocity.multiplyByScaler(u),_=t[p].force.multiplyByScaler(u).multiplyByScaler(u),t[p].position=t[p].position.add(c).add(_),m=t[p].position.substract(t[p-1].position),m.normalize(),t[p].position=t[p-1].position.add(m.multiplyByScaler(t[p].radius)),Dt.abs(t[p].position.x)<a&&(t[p].position.x=0),0!=u&&(t[p].velocity=t[p].position.substract(t[p].lastPosition),t[p].velocity=t[p].velocity.divisionByScalar(u),t[p].velocity=t[p].velocity.multiplyByScaler(t[p].mobility)),t[p].force=new Rt(0,0),t[p].lastGravity=new Rt(g.x,g.y)}function Ze(t,e,i,s,r){let a,n,o;a=r.getScale(r.translationScale,r.angleScale),n=s*a,n<e?(n<r.valueBelowMinimum&&(r.valueBelowMinimum=n),n=e):n>i&&(n>r.valueExceededMaximum&&(r.valueExceededMaximum=n),n=i),o=r.weight/100,o>=1||(n=t[0]*(1-o)+n*o),t[0]=n}function Qe(t,e,i,s,r,a,n,o){let l=0;const u=Dt.max(i,e);u<t&&(t=u);const h=Dt.min(i,e);h>t&&(t=h);const g=Dt.min(r,a),d=Dt.max(r,a),c=n,_=qe(h,u),m=t-_;switch(function(t){let e=0;return t>0?e=1:t<0&&(e=-1),e}(m)){case 1:{const t=d-c,e=u-_;0!=e&&(l=m*(t/e),l+=c);break}case-1:{const t=g-c,e=h-_;0!=e&&(l=m*(t/e),l+=c);break}case 0:l=c}return o?l:-1*l}var $e,ti;!function(t){t.CubismPhysics=Ne,t.Options=Oe}($e||($e={}));class ei{constructor(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s}getCenterX(){return this.x+.5*this.width}getCenterY(){return this.y+.5*this.height}getRight(){return this.x+this.width}getBottom(){return this.y+this.height}setRect(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}expand(t,e){this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e}}(ti||(ti={})).csmRect=ei;let ii,si,ri;class ai{getChannelFlagAsColor(t){return this._channelColors.at(t)}getMaskRenderTexture(){let t=0;if(this._maskTexture&&0!=this._maskTexture.texture&&(this._maskTexture.frameNo=this._currentFrameNo,t=this._maskTexture.texture),0==t){const e=this._clippingMaskBufferSize;this._colorBuffer=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this._colorBuffer),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e,e,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),t=this.gl.createFramebuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this._colorBuffer,0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,ri),this._maskTexture=new ni(this._currentFrameNo,t)}return t}setGL(t){this.gl=t}calcClippedDrawTotalBounds(t,e){let i=Number.MAX_VALUE,s=Number.MAX_VALUE,r=Number.MIN_VALUE,a=Number.MIN_VALUE;const n=e._clippedDrawableIndexList.length;for(let o=0;o<n;o++){const n=e._clippedDrawableIndexList[o],l=t.getDrawableVertexCount(n),u=t.getDrawableVertices(n);let h=Number.MAX_VALUE,g=Number.MAX_VALUE,d=Number.MIN_VALUE,c=Number.MIN_VALUE;const _=l*nt.vertexStep;for(let t=nt.vertexOffset;t<_;t+=nt.vertexStep){const e=u[t],i=u[t+1];e<h&&(h=e),e>d&&(d=e),i<g&&(g=i),i>c&&(c=i)}if(h!=Number.MAX_VALUE)if(h<i&&(i=h),g<s&&(s=g),d>r&&(r=d),c>a&&(a=c),i==Number.MAX_VALUE)e._allClippedDrawRect.x=0,e._allClippedDrawRect.y=0,e._allClippedDrawRect.width=0,e._allClippedDrawRect.height=0,e._isUsing=!1;else{e._isUsing=!0;const t=r-i,n=a-s;e._allClippedDrawRect.x=i,e._allClippedDrawRect.y=s,e._allClippedDrawRect.width=t,e._allClippedDrawRect.height=n}}}constructor(){this._maskRenderTexture=null,this._colorBuffer=null,this._currentFrameNo=0,this._clippingMaskBufferSize=256,this._clippingContextListForMask=new m,this._clippingContextListForDraw=new m,this._channelColors=new m,this._tmpBoundsOnModel=new ei,this._tmpMatrix=new w,this._tmpMatrixForMask=new w,this._tmpMatrixForDraw=new w,this._maskTexture=null;let t=new T;t.R=1,t.G=0,t.B=0,t.A=0,this._channelColors.pushBack(t),t=new T,t.R=0,t.G=1,t.B=0,t.A=0,this._channelColors.pushBack(t),t=new T,t.R=0,t.G=0,t.B=1,t.A=0,this._channelColors.pushBack(t),t=new T,t.R=0,t.G=0,t.B=0,t.A=1,this._channelColors.pushBack(t)}release(){for(let t=0;t<this._clippingContextListForMask.getSize();t++)this._clippingContextListForMask.at(t)&&(this._clippingContextListForMask.at(t).release(),this._clippingContextListForMask.set(t,void 0)),this._clippingContextListForMask.set(t,null);this._clippingContextListForMask=null;for(let t=0;t<this._clippingContextListForDraw.getSize();t++)this._clippingContextListForDraw.set(t,null);this._clippingContextListForDraw=null,this._maskTexture&&(this.gl.deleteFramebuffer(this._maskTexture.texture),this._maskTexture=null);for(let t=0;t<this._channelColors.getSize();t++)this._channelColors.set(t,null);this._channelColors=null,this.gl.deleteTexture(this._colorBuffer),this._colorBuffer=null}initialize(t,e,i,s){for(let r=0;r<e;r++){if(s[r]<=0){this._clippingContextListForDraw.pushBack(null);continue}let t=this.findSameClip(i[r],s[r]);null==t&&(t=new oi(this,i[r],s[r]),this._clippingContextListForMask.pushBack(t)),t.addClippedDrawable(r),this._clippingContextListForDraw.pushBack(t)}}setupClippingContext(t,e){this._currentFrameNo++;let i=0;for(let s=0;s<this._clippingContextListForMask.getSize();s++){const e=this._clippingContextListForMask.at(s);this.calcClippedDrawTotalBounds(t,e),e._isUsing&&i++}if(i>0){this.gl.viewport(0,0,this._clippingMaskBufferSize,this._clippingMaskBufferSize),this._maskRenderTexture=this.getMaskRenderTexture(),e.getMvpMatrix(),e.preDraw(),this.setupLayoutBounds(i),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._maskRenderTexture),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT);for(let i=0;i<this._clippingContextListForMask.getSize();i++){const s=this._clippingContextListForMask.at(i),r=s._allClippedDrawRect,a=s._layoutBounds,n=.05;this._tmpBoundsOnModel.setRect(r),this._tmpBoundsOnModel.expand(r.width*n,r.height*n);const o=a.width/this._tmpBoundsOnModel.width,l=a.height/this._tmpBoundsOnModel.height;this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(a.x,a.y),this._tmpMatrix.scaleRelative(o,l),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(a.x,a.y),this._tmpMatrix.scaleRelative(o,l),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray()),s._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),s._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray());const u=s._clippingIdCount;for(let i=0;i<u;i++){const r=s._clippingIdList[i];t.getDrawableDynamicFlagVertexPositionsDidChange(r)&&(e.setIsCulling(0!=t.getDrawableCulling(r)),e.setClippingContextBufferForMask(s),e.drawMesh(t.getDrawableTextureIndices(r),t.getDrawableVertexIndexCount(r),t.getDrawableVertexCount(r),t.getDrawableVertexIndices(r),t.getDrawableVertices(r),t.getDrawableVertexUvs(r),t.getDrawableOpacity(r),M.CubismBlendMode_Normal,!1))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,ri),e.setClippingContextBufferForMask(null),this.gl.viewport(si[0],si[1],si[2],si[3])}}findSameClip(t,e){for(let i=0;i<this._clippingContextListForMask.getSize();i++){const s=this._clippingContextListForMask.at(i),r=s._clippingIdCount;if(r!=e)continue;let a=0;for(let e=0;e<r;e++){const i=s._clippingIdList[e];for(let e=0;e<r;e++)if(t[e]==i){a++;break}}if(a==r)return s}return null}setupLayoutBounds(t){let e=t/4,i=t%4;e=~~e,i=~~i;let s=0;for(let r=0;r<4;r++){const t=e+(r<i?1:0);if(0==t);else if(1==t){const t=this._clippingContextListForMask.at(s++);t._layoutChannelNo=r,t._layoutBounds.x=0,t._layoutBounds.y=0,t._layoutBounds.width=1,t._layoutBounds.height=1}else if(2==t)for(let e=0;e<t;e++){let t=e%2;t=~~t;const i=this._clippingContextListForMask.at(s++);i._layoutChannelNo=r,i._layoutBounds.x=.5*t,i._layoutBounds.y=0,i._layoutBounds.width=.5,i._layoutBounds.height=1}else if(t<=4)for(let e=0;e<t;e++){let t=e%2,i=e/2;t=~~t,i=~~i;const a=this._clippingContextListForMask.at(s++);a._layoutChannelNo=r,a._layoutBounds.x=.5*t,a._layoutBounds.y=.5*i,a._layoutBounds.width=.5,a._layoutBounds.height=.5}else if(t<=9)for(let e=0;e<t;e++){let t=e%3,i=e/3;t=~~t,i=~~i;const a=this._clippingContextListForMask.at(s++);a._layoutChannelNo=r,a._layoutBounds.x=t/3,a._layoutBounds.y=i/3,a._layoutBounds.width=1/3,a._layoutBounds.height=1/3}else A("not supported mask count : {0}",t)}}getColorBuffer(){return this._colorBuffer}getClippingContextListForDraw(){return this._clippingContextListForDraw}setClippingMaskBufferSize(t){this._clippingMaskBufferSize=t}getClippingMaskBufferSize(){return this._clippingMaskBufferSize}}class ni{constructor(t,e){this.frameNo=t,this.texture=e}}class oi{constructor(t,e,i){this._owner=t,this._clippingIdList=e,this._clippingIdCount=i,this._allClippedDrawRect=new ei,this._layoutBounds=new ei,this._clippedDrawableIndexList=[],this._matrixForMask=new w,this._matrixForDraw=new w}release(){null!=this._layoutBounds&&(this._layoutBounds=null),null!=this._allClippedDrawRect&&(this._allClippedDrawRect=null),null!=this._clippedDrawableIndexList&&(this._clippedDrawableIndexList=null)}addClippedDrawable(t){this._clippedDrawableIndexList.push(t)}getClippingManager(){return this._owner}setGl(t){this._owner.setGL(t)}}class li{static getInstance(){return null==ii?(ii=new li,ii):ii}static deleteInstance(){ii&&(ii.release(),ii=null)}constructor(){this._shaderSets=new m}release(){this.releaseShaderProgram()}setupShaderProgram(t,e,i,s,r,a,n,o,l,u,h,g,d){let c,_,m,p;if(h||A("NoPremultipliedAlpha is not allowed"),0==this._shaderSets.getSize()&&this.generateShaders(),null!=t.getClippingContextBufferForMask()){const i=this._shaderSets.at(hi.ShaderNames_SetupMask);this.gl.useProgram(i.shaderProgram),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(i.samplerTexture0Location,0),null==n.vertex&&(n.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(i.attributePositionLocation),this.gl.vertexAttribPointer(i.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),null==n.uv&&(n.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,a,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(i.attributeTexCoordLocation),this.gl.vertexAttribPointer(i.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0);const r=t.getClippingContextBufferForMask()._layoutChannelNo,o=t.getClippingContextBufferForMask().getClippingManager().getChannelFlagAsColor(r);this.gl.uniform4f(i.uniformChannelFlagLocation,o.R,o.G,o.B,o.A),this.gl.uniformMatrix4fv(i.uniformClipMatrixLocation,!1,t.getClippingContextBufferForMask()._matrixForMask.getArray());const l=t.getClippingContextBufferForMask()._layoutBounds;this.gl.uniform4f(i.uniformBaseColorLocation,2*l.x-1,2*l.y-1,2*l.getRight()-1,2*l.getBottom()-1),c=this.gl.ZERO,_=this.gl.ONE_MINUS_SRC_COLOR,m=this.gl.ZERO,p=this.gl.ONE_MINUS_SRC_ALPHA}else{const i=null!=t.getClippingContextBufferForDraw(),r=i?d?2:1:0;let o=new ui;switch(l){case M.CubismBlendMode_Normal:default:o=this._shaderSets.at(hi.ShaderNames_NormalPremultipliedAlpha+r),c=this.gl.ONE,_=this.gl.ONE_MINUS_SRC_ALPHA,m=this.gl.ONE,p=this.gl.ONE_MINUS_SRC_ALPHA;break;case M.CubismBlendMode_Additive:o=this._shaderSets.at(hi.ShaderNames_AddPremultipliedAlpha+r),c=this.gl.ONE,_=this.gl.ONE,m=this.gl.ZERO,p=this.gl.ONE;break;case M.CubismBlendMode_Multiplicative:o=this._shaderSets.at(hi.ShaderNames_MultPremultipliedAlpha+r),c=this.gl.DST_COLOR,_=this.gl.ONE_MINUS_SRC_ALPHA,m=this.gl.ZERO,p=this.gl.ONE}if(this.gl.useProgram(o.shaderProgram),null==n.vertex&&(n.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(o.attributePositionLocation),this.gl.vertexAttribPointer(o.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),null==n.uv&&(n.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,a,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(o.attributeTexCoordLocation),this.gl.vertexAttribPointer(o.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),i){this.gl.activeTexture(this.gl.TEXTURE1);const e=t.getClippingContextBufferForDraw().getClippingManager().getColorBuffer();this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(o.samplerTexture1Location,1),this.gl.uniformMatrix4fv(o.uniformClipMatrixLocation,!1,t.getClippingContextBufferForDraw()._matrixForDraw.getArray());const i=t.getClippingContextBufferForDraw()._layoutChannelNo,s=t.getClippingContextBufferForDraw().getClippingManager().getChannelFlagAsColor(i);this.gl.uniform4f(o.uniformChannelFlagLocation,s.R,s.G,s.B,s.A)}this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(o.samplerTexture0Location,0),this.gl.uniformMatrix4fv(o.uniformMatrixLocation,!1,g.getArray()),this.gl.uniform4f(o.uniformBaseColorLocation,u.R,u.G,u.B,u.A)}null==n.index&&(n.index=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,n.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,r,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(c,_,m,p)}releaseShaderProgram(){for(let t=0;t<this._shaderSets.getSize();t++)this.gl.deleteProgram(this._shaderSets.at(t).shaderProgram),this._shaderSets.at(t).shaderProgram=0,this._shaderSets.set(t,void 0),this._shaderSets.set(t,null)}generateShaders(){for(let t=0;t<10;t++)this._shaderSets.pushBack(new ui);this._shaderSets.at(0).shaderProgram=this.loadShaderProgram(di,ci),this._shaderSets.at(1).shaderProgram=this.loadShaderProgram(_i,pi),this._shaderSets.at(2).shaderProgram=this.loadShaderProgram(mi,yi),this._shaderSets.at(3).shaderProgram=this.loadShaderProgram(mi,Si),this._shaderSets.at(4).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(5).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(6).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(7).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(8).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(9).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(0).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_position"),this._shaderSets.at(0).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_texCoord"),this._shaderSets.at(0).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"s_texture0"),this._shaderSets.at(0).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_clipMatrix"),this._shaderSets.at(0).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_channelFlag"),this._shaderSets.at(0).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_baseColor"),this._shaderSets.at(1).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_position"),this._shaderSets.at(1).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_texCoord"),this._shaderSets.at(1).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"s_texture0"),this._shaderSets.at(1).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_matrix"),this._shaderSets.at(1).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_baseColor"),this._shaderSets.at(2).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_position"),this._shaderSets.at(2).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_texCoord"),this._shaderSets.at(2).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture0"),this._shaderSets.at(2).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture1"),this._shaderSets.at(2).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_matrix"),this._shaderSets.at(2).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_clipMatrix"),this._shaderSets.at(2).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_channelFlag"),this._shaderSets.at(2).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_baseColor"),this._shaderSets.at(3).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_position"),this._shaderSets.at(3).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_texCoord"),this._shaderSets.at(3).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture0"),this._shaderSets.at(3).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture1"),this._shaderSets.at(3).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_matrix"),this._shaderSets.at(3).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_clipMatrix"),this._shaderSets.at(3).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_channelFlag"),this._shaderSets.at(3).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_baseColor"),this._shaderSets.at(4).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_position"),this._shaderSets.at(4).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_texCoord"),this._shaderSets.at(4).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"s_texture0"),this._shaderSets.at(4).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_matrix"),this._shaderSets.at(4).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_baseColor"),this._shaderSets.at(5).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_position"),this._shaderSets.at(5).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_texCoord"),this._shaderSets.at(5).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture0"),this._shaderSets.at(5).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture1"),this._shaderSets.at(5).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_matrix"),this._shaderSets.at(5).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_clipMatrix"),this._shaderSets.at(5).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_channelFlag"),this._shaderSets.at(5).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_baseColor"),this._shaderSets.at(6).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_position"),this._shaderSets.at(6).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_texCoord"),this._shaderSets.at(6).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture0"),this._shaderSets.at(6).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture1"),this._shaderSets.at(6).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_matrix"),this._shaderSets.at(6).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_clipMatrix"),this._shaderSets.at(6).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_channelFlag"),this._shaderSets.at(6).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_baseColor"),this._shaderSets.at(7).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_position"),this._shaderSets.at(7).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_texCoord"),this._shaderSets.at(7).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"s_texture0"),this._shaderSets.at(7).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_matrix"),this._shaderSets.at(7).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_baseColor"),this._shaderSets.at(8).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_position"),this._shaderSets.at(8).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_texCoord"),this._shaderSets.at(8).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture0"),this._shaderSets.at(8).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture1"),this._shaderSets.at(8).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_matrix"),this._shaderSets.at(8).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_clipMatrix"),this._shaderSets.at(8).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_channelFlag"),this._shaderSets.at(8).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_baseColor"),this._shaderSets.at(9).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_position"),this._shaderSets.at(9).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_texCoord"),this._shaderSets.at(9).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture0"),this._shaderSets.at(9).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture1"),this._shaderSets.at(9).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_matrix"),this._shaderSets.at(9).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_clipMatrix"),this._shaderSets.at(9).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_channelFlag"),this._shaderSets.at(9).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_baseColor")}loadShaderProgram(t,e){let i=this.gl.createProgram(),s=this.compileShaderSource(this.gl.VERTEX_SHADER,t);if(!s)return A("Vertex shader compile error!"),0;let r=this.compileShaderSource(this.gl.FRAGMENT_SHADER,e);if(!r)return A("Vertex shader compile error!"),0;this.gl.attachShader(i,s),this.gl.attachShader(i,r),this.gl.linkProgram(i);return this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?(this.gl.deleteShader(s),this.gl.deleteShader(r),i):(A("Failed to link program: {0}",i),this.gl.deleteShader(s),s=0,this.gl.deleteShader(r),r=0,i&&(this.gl.deleteProgram(i),i=0),0)}compileShaderSource(t,e){const i=e,s=this.gl.createShader(t);if(this.gl.shaderSource(s,i),this.gl.compileShader(s),!s){const t=this.gl.getShaderInfoLog(s);A("Shader compile log: {0} ",t)}return this.gl.getShaderParameter(s,this.gl.COMPILE_STATUS)?s:(this.gl.deleteShader(s),null)}setGl(t){this.gl=t}}class ui{}var hi,gi;(gi=hi||(hi={}))[gi.ShaderNames_SetupMask=0]="ShaderNames_SetupMask",gi[gi.ShaderNames_NormalPremultipliedAlpha=1]="ShaderNames_NormalPremultipliedAlpha",gi[gi.ShaderNames_NormalMaskedPremultipliedAlpha=2]="ShaderNames_NormalMaskedPremultipliedAlpha",gi[gi.ShaderNames_NomralMaskedInvertedPremultipliedAlpha=3]="ShaderNames_NomralMaskedInvertedPremultipliedAlpha",gi[gi.ShaderNames_AddPremultipliedAlpha=4]="ShaderNames_AddPremultipliedAlpha",gi[gi.ShaderNames_AddMaskedPremultipliedAlpha=5]="ShaderNames_AddMaskedPremultipliedAlpha",gi[gi.ShaderNames_AddMaskedPremultipliedAlphaInverted=6]="ShaderNames_AddMaskedPremultipliedAlphaInverted",gi[gi.ShaderNames_MultPremultipliedAlpha=7]="ShaderNames_MultPremultipliedAlpha",gi[gi.ShaderNames_MultMaskedPremultipliedAlpha=8]="ShaderNames_MultMaskedPremultipliedAlpha",gi[gi.ShaderNames_MultMaskedPremultipliedAlphaInverted=9]="ShaderNames_MultMaskedPremultipliedAlphaInverted";const di="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_myPos;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_clipMatrix * a_position;   v_myPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",ci="precision mediump float;varying vec2       v_texCoord;varying vec4       v_myPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;void main(){   float isInside =        step(u_baseColor.x, v_myPos.x/v_myPos.w)       * step(u_baseColor.y, v_myPos.y/v_myPos.w)       * step(v_myPos.x/v_myPos.w, u_baseColor.z)       * step(v_myPos.y/v_myPos.w, u_baseColor.w);   gl_FragColor = u_channelFlag * texture2D(s_texture0, v_texCoord).a * isInside;}",_i="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;uniform mat4       u_matrix;void main(){   gl_Position = u_matrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",mi="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform mat4       u_matrix;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_matrix * a_position;   v_clipPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",pi="precision mediump float;varying vec2       v_texCoord;uniform vec4       u_baseColor;uniform sampler2D  s_texture0;void main(){   gl_FragColor = texture2D(s_texture0 , v_texCoord) * u_baseColor;}",yi="precision mediump float;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;void main(){   vec4 col_formask = texture2D(s_texture0 , v_texCoord) * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * maskVal;   gl_FragColor = col_formask;}",Si="precision mediump float;varying vec2 v_texCoord;varying vec4 v_clipPos;uniform sampler2D s_texture0;uniform sampler2D s_texture1;uniform vec4 u_channelFlag;uniform vec4 u_baseColor;void main(){vec4 col_formask = texture2D(s_texture0, v_texCoord) * u_baseColor;vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;col_formask = col_formask * (1.0 - maskVal);gl_FragColor = col_formask;}";class fi extends E{initialize(t){t.isUsingMasking()&&(this._clippingManager=new ai,this._clippingManager.initialize(t,t.getDrawableCount(),t.getDrawableMasks(),t.getDrawableMaskCounts())),this._sortedDrawableIndexList.resize(t.getDrawableCount(),0),super.initialize(t)}bindTexture(t,e){this._textures.setValue(t,e)}getBindedTextures(){return this._textures}setClippingMaskBufferSize(t){this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null,this._clippingManager=new ai,this._clippingManager.setClippingMaskBufferSize(t),this._clippingManager.initialize(this.getModel(),this.getModel().getDrawableCount(),this.getModel().getDrawableMasks(),this.getModel().getDrawableMaskCounts())}getClippingMaskBufferSize(){return this._clippingManager.getClippingMaskBufferSize()}constructor(){super(),this._clippingContextBufferForMask=null,this._clippingContextBufferForDraw=null,this._clippingManager=new ai,this.firstDraw=!0,this._textures=new j,this._sortedDrawableIndexList=new m,this._bufferData={vertex:WebGLBuffer=null,uv:WebGLBuffer=null,index:WebGLBuffer=null},this._textures.prepareCapacity(32,!0)}release(){this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null,this.gl.deleteBuffer(this._bufferData.vertex),this._bufferData.vertex=null,this.gl.deleteBuffer(this._bufferData.uv),this._bufferData.uv=null,this.gl.deleteBuffer(this._bufferData.index),this._bufferData.index=null,this._bufferData=null,this._textures=null}doDrawModel(){null!=this._clippingManager&&(this.preDraw(),this._clippingManager.setupClippingContext(this.getModel(),this)),this.preDraw();const t=this.getModel().getDrawableCount(),e=this.getModel().getDrawableRenderOrders();for(let i=0;i<t;++i){const t=e[i];this._sortedDrawableIndexList.set(t,i)}for(let i=0;i<t;++i){const t=this._sortedDrawableIndexList.at(i);this.getModel().getDrawableDynamicFlagIsVisible(t)&&(this.setClippingContextBufferForDraw(null!=this._clippingManager?this._clippingManager.getClippingContextListForDraw().at(t):null),this.setIsCulling(this.getModel().getDrawableCulling(t)),this.drawMesh(this.getModel().getDrawableTextureIndices(t),this.getModel().getDrawableVertexIndexCount(t),this.getModel().getDrawableVertexCount(t),this.getModel().getDrawableVertexIndices(t),this.getModel().getDrawableVertices(t),this.getModel().getDrawableVertexUvs(t),this.getModel().getDrawableOpacity(t),this.getModel().getDrawableBlendMode(t),this.getModel().getDrawableInvertedMaskBit(t)))}}drawMesh(t,e,i,s,r,a,n,o,l){this.isCulling()?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW);const u=this.getModelColor();let h;null==this.getClippingContextBufferForMask()&&(u.A*=n,this.isPremultipliedAlpha()&&(u.R*=u.A,u.G*=u.A,u.B*=u.A)),h=null!=this._textures.getValue(t)?this._textures.getValue(t):null,li.getInstance().setupShaderProgram(this,h,i,r,s,a,this._bufferData,n,o,u,this.isPremultipliedAlpha(),this.getMvpMatrix(),l),this.gl.drawElements(this.gl.TRIANGLES,e,this.gl.UNSIGNED_SHORT,0),this.gl.useProgram(null),this.setClippingContextBufferForDraw(null),this.setClippingContextBufferForMask(null)}static doStaticRelease(){li.deleteInstance()}setRenderState(t,e){ri=t,si=e}preDraw(){this.firstDraw&&(this.firstDraw=!1,this._anisortopy=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.frontFace(this.gl.CW),this.gl.enable(this.gl.BLEND),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null)}setClippingContextBufferForMask(t){this._clippingContextBufferForMask=t}getClippingContextBufferForMask(){return this._clippingContextBufferForMask}setClippingContextBufferForDraw(t){this._clippingContextBufferForDraw=t}getClippingContextBufferForDraw(){return this._clippingContextBufferForDraw}startUp(t){this.gl=t,this._clippingManager.setGL(t),li.getInstance().setGl(t)}}var xi,Ci,Bi;E.staticRelease=()=>{fi.doStaticRelease()},function(t){t.CubismClippingContext=oi,t.CubismClippingManager_WebGL=ai,t.CubismRenderTextureResource=ni,t.CubismRenderer_WebGL=fi,t.CubismShaderSet=ui,t.CubismShader_WebGL=li,t.ShaderNames=hi}(xi||(xi={}));class Mi{update(){this._model.update(),this._model.drawables.resetDynamicFlags()}getCanvasWidth(){return null==this._model?0:this._model.canvasinfo.CanvasWidth/this._model.canvasinfo.PixelsPerUnit}getCanvasHeight(){return null==this._model?0:this._model.canvasinfo.CanvasHeight/this._model.canvasinfo.PixelsPerUnit}saveParameters(){const t=this._model.parameters.count,e=this._savedParameters.getSize();for(let i=0;i<t;++i)i<e?this._savedParameters.set(i,this._parameterValues[i]):this._savedParameters.pushBack(this._parameterValues[i])}getModel(){return this._model}getPartIndex(t){let e;const i=this._model.parts.count;for(e=0;e<i;++e)if(t==this._partIds.at(e))return e;return this._notExistPartId.isExist(t)?this._notExistPartId.getValue(t):(e=i+this._notExistPartId.getSize(),this._notExistPartId.setValue(t,e),this._notExistPartOpacities.appendKey(e),e)}getPartCount(){return this._model.parts.count}setPartOpacityByIndex(t,e){this._notExistPartOpacities.isExist(t)?this._notExistPartOpacities.setValue(t,e):(R(0<=t&&t<this.getPartCount()),this._partOpacities[t]=e)}setPartOpacityById(t,e){const i=this.getPartIndex(t);i<0||this.setPartOpacityByIndex(i,e)}getPartOpacityByIndex(t){return this._notExistPartOpacities.isExist(t)?this._notExistPartOpacities.getValue(t):(R(0<=t&&t<this.getPartCount()),this._partOpacities[t])}getPartOpacityById(t){const e=this.getPartIndex(t);return e<0?0:this.getPartOpacityByIndex(e)}getParameterIndex(t){let e;const i=this._model.parameters.count;for(e=0;e<i;++e)if(t==this._parameterIds.at(e))return e;return this._notExistParameterId.isExist(t)?this._notExistParameterId.getValue(t):(e=this._model.parameters.count+this._notExistParameterId.getSize(),this._notExistParameterId.setValue(t,e),this._notExistParameterValues.appendKey(e),e)}getParameterCount(){return this._model.parameters.count}getParameterMaximumValue(t){return this._model.parameters.maximumValues[t]}getParameterMinimumValue(t){return this._model.parameters.minimumValues[t]}getParameterDefaultValue(t){return this._model.parameters.defaultValues[t]}getParameterValueByIndex(t){return this._notExistParameterValues.isExist(t)?this._notExistParameterValues.getValue(t):(R(0<=t&&t<this.getParameterCount()),this._parameterValues[t])}getParameterValueById(t){const e=this.getParameterIndex(t);return this.getParameterValueByIndex(e)}setParameterValueByIndex(t,e,i=1){this._notExistParameterValues.isExist(t)?this._notExistParameterValues.setValue(t,1==i?e:this._notExistParameterValues.getValue(t)*(1-i)+e*i):(R(0<=t&&t<this.getParameterCount()),this._model.parameters.maximumValues[t]<e&&(e=this._model.parameters.maximumValues[t]),this._model.parameters.minimumValues[t]>e&&(e=this._model.parameters.minimumValues[t]),this._parameterValues[t]=1==i?e:this._parameterValues[t]=this._parameterValues[t]*(1-i)+e*i)}setParameterValueById(t,e,i=1){const s=this.getParameterIndex(t);this.setParameterValueByIndex(s,e,i)}addParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)+e*i)}addParameterValueById(t,e,i=1){const s=this.getParameterIndex(t);this.addParameterValueByIndex(s,e,i)}multiplyParameterValueById(t,e,i=1){const s=this.getParameterIndex(t);this.multiplyParameterValueByIndex(s,e,i)}multiplyParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)*(1+(e-1)*i))}getDrawableIndex(t){const e=this._model.drawables.count;for(let i=0;i<e;++i)if(this._drawableIds.at(i)==t)return i;return-1}getDrawableCount(){return this._model.drawables.count}getDrawableId(t){const e=this._model.drawables.ids;return lt.getIdManager().getId(e[t])}getDrawableRenderOrders(){return this._model.drawables.renderOrders}getDrawableTextureIndices(t){return this._model.drawables.textureIndices[t]}getDrawableDynamicFlagVertexPositionsDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(e[t])}getDrawableVertexIndexCount(t){return this._model.drawables.indexCounts[t]}getDrawableVertexCount(t){return this._model.drawables.vertexCounts[t]}getDrawableVertices(t){return this.getDrawableVertexPositions(t)}getDrawableVertexIndices(t){return this._model.drawables.indices[t]}getDrawableVertexPositions(t){return this._model.drawables.vertexPositions[t]}getDrawableVertexUvs(t){return this._model.drawables.vertexUvs[t]}getDrawableOpacity(t){return this._model.drawables.opacities[t]}getDrawableCulling(t){const e=this._model.drawables.constantFlags;return!Live2DCubismCore.Utils.hasIsDoubleSidedBit(e[t])}getDrawableBlendMode(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasBlendAdditiveBit(e[t])?M.CubismBlendMode_Additive:Live2DCubismCore.Utils.hasBlendMultiplicativeBit(e[t])?M.CubismBlendMode_Multiplicative:M.CubismBlendMode_Normal}getDrawableInvertedMaskBit(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasIsInvertedMaskBit(e[t])}getDrawableMasks(){return this._model.drawables.masks}getDrawableMaskCounts(){return this._model.drawables.maskCounts}isUsingMasking(){for(let t=0;t<this._model.drawables.count;++t)if(!(this._model.drawables.maskCounts[t]<=0))return!0;return!1}getDrawableDynamicFlagIsVisible(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasIsVisibleBit(e[t])}getDrawableDynamicFlagVisibilityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVisibilityDidChangeBit(e[t])}getDrawableDynamicFlagOpacityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasOpacityDidChangeBit(e[t])}getDrawableDynamicFlagRenderOrderDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(e[t])}loadParameters(){let t=this._model.parameters.count;const e=this._savedParameters.getSize();t>e&&(t=e);for(let i=0;i<t;++i)this._parameterValues[i]=this._savedParameters.at(i)}initialize(){R(this._model),this._parameterValues=this._model.parameters.values,this._partOpacities=this._model.parts.opacities,this._parameterMaximumValues=this._model.parameters.maximumValues,this._parameterMinimumValues=this._model.parameters.minimumValues;{const t=this._model.parameters.ids,e=this._model.parameters.count;this._parameterIds.prepareCapacity(e);for(let i=0;i<e;++i)this._parameterIds.pushBack(lt.getIdManager().getId(t[i]))}{const t=this._model.parts.ids,e=this._model.parts.count;this._partIds.prepareCapacity(e);for(let i=0;i<e;++i)this._partIds.pushBack(lt.getIdManager().getId(t[i]))}{const t=this._model.drawables.ids,e=this._model.drawables.count;this._drawableIds.prepareCapacity(e);for(let i=0;i<e;++i)this._drawableIds.pushBack(lt.getIdManager().getId(t[i]))}}constructor(t){this._model=t,this._parameterValues=null,this._parameterMaximumValues=null,this._parameterMinimumValues=null,this._partOpacities=null,this._savedParameters=new m,this._parameterIds=new m,this._drawableIds=new m,this._partIds=new m,this._notExistPartId=new j,this._notExistParameterId=new j,this._notExistParameterValues=new j,this._notExistPartOpacities=new j}release(){this._model.release(),this._model=null}}(Ci||(Ci={})).CubismModel=Mi;class Vi{static create(t){let e=null;const i=Live2DCubismCore.Moc.fromArrayBuffer(t);return i&&(e=new Vi(i)),e}static delete(t){t._moc._release(),t._moc=null,t=null}createModel(){let t=null;const e=Live2DCubismCore.Model.fromMoc(this._moc);return e&&(t=new Mi(e),t.initialize(),++this._modelCount),t}deleteModel(t){null!=t&&(t.release(),t=null,--this._modelCount)}constructor(t){this._moc=t,this._modelCount=0}release(){R(0==this._modelCount),this._moc._release(),this._moc=null}}(Bi||(Bi={})).CubismMoc=Vi;class Ii{constructor(t,e){this._json=q.create(t,e)}release(){q.delete(this._json)}getUserDataCount(){return this._json.getRoot().getValueByString("Meta").getValueByString("UserDataCount").toInt()}getTotalUserDataSize(){return this._json.getRoot().getValueByString("Meta").getValueByString("TotalUserDataSize").toInt()}getUserDataTargetType(t){return this._json.getRoot().getValueByString("UserData").getValueByIndex(t).getValueByString("Target").getRawString()}getUserDataId(t){return lt.getIdManager().getId(this._json.getRoot().getValueByString("UserData").getValueByIndex(t).getValueByString("Id").getRawString())}getUserDataValue(t){return this._json.getRoot().getValueByString("UserData").getValueByIndex(t).getValueByString("Value").getRawString()}}var bi;(bi||(bi={})).CubismModelUserDataJson=Ii;class vi{}class Pi{static create(t,e){const i=new Pi;return i.parseUserData(t,e),i}static delete(t){null!=t&&(t.release(),t=null)}getArtMeshUserDatas(){return this._artMeshUserDataNode}parseUserData(t,e){let i=new Ii(t,e);const s=lt.getIdManager().getId("ArtMesh"),r=i.getUserDataCount();for(let a=0;a<r;a++){const t=new vi;t.targetId=i.getUserDataId(a),t.targetType=lt.getIdManager().getId(i.getUserDataTargetType(a)),t.value=new b(i.getUserDataValue(a)),this._userDataNodes.pushBack(t),t.targetType==s&&this._artMeshUserDataNode.pushBack(t)}i.release(),i=void 0}constructor(){this._userDataNodes=new m,this._artMeshUserDataNode=new m}release(){for(let t=0;t<this._userDataNodes.getSize();++t)this._userDataNodes.set(t,null);this._userDataNodes=null}}var wi,Ei;!function(t){t.CubismModelUserData=Pi,t.CubismModelUserDataNode=vi}(wi||(wi={}));class Ti{constructor(){this.loadMotion=(t,e,i,s)=>ce.create(t,e,s),this._moc=null,this._model=null,this._motionManager=null,this._expressionManager=null,this._eyeBlink=null,this._breath=null,this._modelMatrix=null,this._pose=null,this._dragManager=null,this._physics=null,this._modelUserData=null,this._initialized=!1,this._updating=!1,this._opacity=1,this._lipsync=!0,this._lastLipSyncValue=0,this._dragX=0,this._dragY=0,this._accelerationX=0,this._accelerationY=0,this._accelerationZ=0,this._debugMode=!1,this._renderer=null,this._motionManager=new be,this._motionManager.setEventCallback(Ti.cubismDefaultMotionEventCallback,this),this._expressionManager=new be,this._dragManager=new At}isInitialized(){return this._initialized}setInitialized(t){this._initialized=t}isUpdating(){return this._updating}setUpdating(t){this._updating=t}setDragging(t,e){this._dragManager.set(t,e)}setAcceleration(t,e,i){this._accelerationX=t,this._accelerationY=e,this._accelerationZ=i}getModelMatrix(){return this._modelMatrix}setOpacity(t){this._opacity=t}getOpacity(){return this._opacity}loadModel(t){this._moc=Vi.create(t),this._model=this._moc.createModel(),this._model.saveParameters(),null!=this._moc&&null!=this._model?this._modelMatrix=new Ft(this._model.getCanvasWidth(),this._model.getCanvasHeight()):A("Failed to CreateModel().")}loadExpression(t,e,i){return Ut.create(t,e)}loadPose(t,e){this._pose=vt.create(t,e)}loadUserData(t,e){this._modelUserData=Pi.create(t,e)}loadPhysics(t,e){this._physics=Ne.create(t,e)}isHit(t,e,i){const s=this._model.getDrawableIndex(t);if(s<0)return!1;const r=this._model.getDrawableVertexCount(s),a=this._model.getDrawableVertices(s);let n=a[0],o=a[0],l=a[1],u=a[1];for(let d=1;d<r;++d){const t=a[nt.vertexOffset+d*nt.vertexStep],e=a[nt.vertexOffset+d*nt.vertexStep+1];t<n&&(n=t),t>o&&(o=t),e<l&&(l=e),e>u&&(u=e)}const h=this._modelMatrix.invertTransformX(e),g=this._modelMatrix.invertTransformY(i);return n<=h&&h<=o&&l<=g&&g<=u}getModel(){return this._model}getRenderer(){return this._renderer}createRenderer(){this._renderer&&this.deleteRenderer(),this._renderer=new fi,this._renderer.initialize(this._model)}deleteRenderer(){null!=this._renderer&&(this._renderer.release(),this._renderer=null)}motionEventFired(t){D("{0}",t.s)}static cubismDefaultMotionEventCallback(t,e,i){null!=i&&i.motionEventFired(e)}release(){null!=this._motionManager&&(this._motionManager.release(),this._motionManager=null),null!=this._expressionManager&&(this._expressionManager.release(),this._expressionManager=null),null!=this._moc&&(this._moc.deleteModel(this._model),this._moc.release(),this._moc=null),this._modelMatrix=null,vt.delete(this._pose),Mt.delete(this._eyeBlink),xt.delete(this._breath),this._dragManager=null,Ne.delete(this._physics),Pi.delete(this._modelUserData),this.deleteRenderer()}}(Ei||(Ei={})).CubismUserModel=Ti;const Fi=lt;dt.ICubismModelSetting;class Ri extends yt.CubismModelSettingJson{}class Li extends B.CubismMatrix44{}class Di extends Ei.CubismUserModel{}Ot.ACubismMotion;_e.CubismMotion;Gt.CubismExpressionMotion;xe.CubismMotionManager;$e.CubismPhysics;class ki extends bt.CubismEyeBlink{}class Ai extends y.csmVector{}class Ni extends Di{constructor(){super(),a(this,"motionResources"),a(this,"expressionResources"),a(this,"lipSyncParamIds",new Ai),a(this,"eyeBlinkParamIds",new Ai),this.motionResources={},this.expressionResources={},this.lipSyncParamIds=new Ai,this.eyeBlinkParamIds=new Ai,this._lipsync=!1}setEyeBlink(t){this._eyeBlink=t}addEyeBlinkParameterId(t){this.eyeBlinkParamIds.pushBack(t)}addLipSyncParameterId(t){this.lipSyncParamIds.pushBack(t)}addMotion(t,e,i=1,s=1){const r=this.loadMotion(t,t.byteLength,e);return i>0&&r.setFadeInTime(i),s>0&&r.setFadeOutTime(s),r.setEffectIds(this.eyeBlinkParamIds,this.lipSyncParamIds),this.motionResources[e]=r,e}addExpression(t,e,i=1,s=1){const r=this.loadExpression(t,t.byteLength,e);return i>0&&r.setFadeInTime(i),s>0&&r.setFadeOutTime(s),this.expressionResources[e]=r,e}get motionNames(){return Object.keys(this.motionResources)}get isMotionFinished(){return this._motionManager.isFinished()}startMotionByName(t){const e=this.motionResources[t];e&&this._motionManager.startMotionPriority(e,!1,0)}startExpressionByName(t){const e=this.expressionResources[t];e&&this._expressionManager.startMotionPriority(e,!1,1)}update(t){this.getModel().loadParameters();const e=this._motionManager.updateMotion(this.getModel(),t),i=this._expressionManager.updateMotion(this.getModel(),t);this.getModel().saveParameters(),e||i||null==this._eyeBlink||this._eyeBlink.updateParameters(this._model,t),null!==this._pose&&this._pose.updateParameters(this._model,0),null!=this._physics&&this._physics.evaluate(this._model,t),this._model.update()}}const Oi={autoBlink:!0,x:0,y:0,scale:1};let zi=!1;class Ui{constructor(t){a(this,"canvas"),a(this,"model",new Ni),a(this,"point",new c),this.canvas=t}async init(t,e,i={}){const s=this.canvas.getContext("webgl");if(null===s)throw new Error("WebGL");s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA),s.clearColor(0,0,0,0),s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL);const r=Object.assign({},Oi,i),a=s.getParameter(s.FRAMEBUFFER_BINDING);zi||(Fi.startUp(),Fi.initialize(),zi=!0);const n=new Ri(t,t.byteLength),{moc3:o,textures:l,physics:u,expressions:h,motions:g}=e;this.model.loadModel(o),this.model.createRenderer();let d=0;for(const V of l){const t=await ji(V,s);this.model.getRenderer().bindTexture(d,t),d++}this.model.getRenderer().setIsPremultipliedAlpha(!0),this.model.getRenderer().startUp(s),r.autoBlink&&this.model.setEyeBlink(ki.create(n));for(let V=0,I=n.getEyeBlinkParameterCount();V<I;V++)this.model.addEyeBlinkParameterId(n.getEyeBlinkParameterId(V));for(let V=0,I=n.getLipSyncParameterCount();V<I;V++)this.model.addLipSyncParameterId(n.getLipSyncParameterId(V));this.model.loadPhysics(u,u.byteLength);for(const[V,I]of h)this.model.addExpression(I,V);for(const[V,I]of g)this.model.addMotion(I,V);const c=Object.assign({x:0,y:0,z:1},{x:r.x,y:r.y,z:r.scale}),_=new Li,m=()=>{this.canvas.width=this.canvas.clientWidth*devicePixelRatio,this.canvas.height=this.canvas.clientHeight*devicePixelRatio;const t=this.model.getModelMatrix();t.bottom(0),t.centerY(-1),t.translateY(-1),_.loadIdentity();1<this.canvas.height/this.canvas.width?t.scale(1,this.canvas.width/this.canvas.height):t.scale(this.canvas.height/this.canvas.width,1),t.translateRelative(c.x,c.y),_.multiplyByMatrix(t);const e=c.z;_.scaleRelative(e,e),this.model.getRenderer().setMvpMatrix(_)};m();const p=[0,0,this.canvas.width,this.canvas.height];let y=Date.now();const S=this.model.getModel(),f=Fi.getIdManager(),x=()=>{const t=Date.now(),e=(t-y)/1e3;S.setParameterValueById(f.getId("ParamAngleX"),this.point.angleX,.5),S.setParameterValueById(f.getId("ParamAngleY"),this.point.angleY,.5),S.setParameterValueById(f.getId("ParamAngleZ"),this.point.angleZ,.5),S.setParameterValueById(f.getId("ParamEyeBallX"),this.point.angleEyeX,.5),S.setParameterValueById(f.getId("ParamEyeBallY"),this.point.angleEyeY,.5),S.setParameterValueById(f.getId("ParamBodyAngleZ"),this.point.angleZ/2,.05),S.saveParameters(),this.model.update(e),p[2]=this.canvas.width,p[3]=this.canvas.height,this.model.getRenderer().setRenderState(a,p),this.model.getRenderer().drawModel(),y=t,requestAnimationFrame(x)};window.addEventListener("resize",(()=>{m(),x()})),x();const C=["akubi","akubi","swing","AiArt"],B=()=>{setTimeout((()=>{this.model.isMotionFinished&&this.model.startMotionByName(C[Math.floor(Math.random()*C.length)]),B()}),1e4+1e3*Math.random()*80)};B();const M=()=>{setTimeout((()=>{this.model.startMotionByName("mimi"),M()}),1e4+1e3*Math.random()*30)};M()}updatePoint(t){Object.assign(this.point,t)}click(t){const e=this.canvas.getBoundingClientRect(),i=e.left+e.width/2,s=e.top+e.height/2,r=(t.clientX-i)/(e.width/2),a=(t.clientY-s)/(e.height/2);this.model.isHit(Fi.getIdManager().getId("HitArea"),r,a)||this.model.isHit(Fi.getIdManager().getId("HitArea2"),r,a)||this.model.isHit(Fi.getIdManager().getId("HitArea_Body"),r,a)?this.model.startMotionByName("mimi"):this.model.isHit(Fi.getIdManager().getId("HitArea_Head"),r,a)}}async function ji(t,e){return new Promise((i=>{const s=URL.createObjectURL(t),r=new Image;r.onload=()=>{const t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),e.generateMipmap(e.TEXTURE_2D),URL.revokeObjectURL(s),i(t)},r.addEventListener("error",(()=>{console.error("image load error")})),r.src=s}))}const Xi="https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js",Gi="./misskey/live2d/ai/web/",Yi={moc3:Gi+"ai.moc3",model3:Gi+"ai.model3.json",physics3:Gi+"ai.physics3.json",textures:[Gi+"ai.4096/texture_00.png"],expressions:{smile:Gi+"expressions/exp_01.exp3.json",surprise:Gi+"expressions/exp_02.exp3.json",happy:Gi+"expressions/exp_06.exp3.json",jitome:Gi+"expressions/exp_11.exp3.json",gurugurume:Gi+"expressions/exp_20.exp3.json"},motions:{swing:Gi+"motions/mtn_03.motion3.json",akubi:Gi+"motions/mtn_04.motion3.json",mimi:Gi+"motions/mtn_05.motion3.json",AiArt:Gi+"motions/AiArt.motion3.json"}};let qi=!1;async function Wi(t,a){try{const[n,o,l,u,h,g]=await Promise.all([fetch(Yi.model3).then((t=>t.arrayBuffer())),fetch(Yi.moc3).then((t=>t.arrayBuffer())),fetch(Yi.physics3).then((t=>t.arrayBuffer())),Promise.all(Yi.textures.map((t=>fetch(t).then((t=>t.blob()))))),Promise.all(Object.entries(Yi.expressions).map((([t,e])=>fetch(e).then((t=>t.arrayBuffer())).then((e=>[t,e]))))),Promise.all(Object.entries(Yi.motions).map((([t,e])=>fetch(e).then((t=>t.arrayBuffer())).then((e=>[t,e])))))]),d=new Ui(t);await d.init(n,{moc3:o,physics:l,textures:u,expressions:h,motions:g},((t,a)=>{for(var n in a||(a={}))i.call(a,n)&&r(t,n,a[n]);if(e)for(var n of e(a))s.call(a,n)&&r(t,n,a[n]);return t})({autoBlink:!0},a));const _=new c,m=e=>{const i=e.x,s=e.y,r=t.getBoundingClientRect(),n=a.eyeX?a.eyeX:r.left+r.width/2,o=a.eyeY?a.eyeY:r.top+r.height/2,l=(u=i,h=s,g=n,c=o,Math.atan2(c-h,g-u));var u,h,g,c;const m=Math.cos(l)*Math.sin(l)*180/Math.PI,p=function(t,e,i,s){return Math.sqrt(Math.pow(i-t,2)+Math.pow(s-e,2))}(i,s,n,o),y=n-i,S=o-s;Object.assign(_,{angleX:-y/10,angleY:S/10,angleZ:m*(p/n)/10,angleEyeX:-y/n/10,angleEyeY:S/o/2}),d.updatePoint(_)};return document.body.addEventListener("mousemove",(t=>{m({x:t.clientX,y:t.clientY})}),!1),window.addEventListener("message",(t=>{const{type:e,body:i}=t.data;switch(e){case"setPos":break;case"moveCursor":m(i)}}),!1),d}catch(n){alert(n.message),console.error(n)}}d(n({setup(t,{expose:e}){let i=null;const s=o(),r=t=>{i&&i.click(t)};return l((()=>{const t=new URL(window.location.href);(function(t,e){return new Promise(((i,s)=>{const r=document.head.querySelector(`script[src="${Xi}"]`);if(r)qi?Wi(t,e).then((t=>{i(t)})):r.addEventListener("load",(()=>{Wi(t,e).then((t=>{i(t)}))}));else{const s=document.createElement("script");s.setAttribute("src",Xi),document.head.appendChild(s),s.addEventListener("load",(()=>{qi=!0,Wi(t,e).then((t=>{i(t)}))}))}}))})(s.value,{scale:parseFloat(t.searchParams.get("scale")||"1"),x:parseFloat(t.searchParams.get("x")||"0"),y:parseFloat(t.searchParams.get("y")||"1"),eyeX:t.searchParams.has("eyeX")?parseFloat(t.searchParams.get("eyeX")):void 0,eyeY:t.searchParams.has("eyeY")?parseFloat(t.searchParams.get("eyeY")):void 0}).then((t=>{i=u(t)}))})),e({canvas:s,touched:r}),(t,e)=>(g(),h("canvas",{id:"canvas",ref:(t,e)=>{e.canvas=t,s.value=t},onClick:r},null,512))}})).mount("#app");
